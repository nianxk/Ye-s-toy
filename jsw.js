!function(n){var o={};function i(e){if(o[e])return o[e].exports;var t=o[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.m=n,i.c=o,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=2)}([function(e,t,n){var o=n(4),i=o.jSW,s=o.dMgr,r=s.ClaimModule("jSWProtocol"),a=s.ClaimModule("jSWUtils"),l=s.ClaimModule("jSWOptions"),n=s.ClaimModule("PuLoad"),o=s.ClaimModule("AudioMgr"),s=s.ClaimModule("HTTPNruFile");e.exports={jSWProtocol:r,jSWUtils:a,jSWOptions:l,PuLoad:n,AudioMgr:o,HTTPNruFile:s,jSW:i}},function(e,t,n){e.exports=n(3)},function(e,t,n){"use strict";n.r(t);t=n(1),t=n.n(t);t.a.version=Object({SdkVer:"2021-11-29 18:01:26",ReqOcxVer:"2021-11-29 17:57:32",WebSerMidVer:"2021-11-22 16:49:24"}),console.log(""),console.log("JSW Version Info, You Can Find That Here: jSW['version']"),console.log("                  Sdk 2021-11-29 18:01:26"),console.log("          Require Ocx 2021-11-29 17:57:32"),console.log("Web Server Middleware 2021-11-22 16:49:24"),console.log(""),window.jSW=t.a},function(e,t,n){var o=n(0).jSW;n(6),n(7),n(8),n(9),n(10),n(11),n(12),n(13),n(14),e.exports=o},function(module,exports,__webpack_require__){var jSW={},module_entry=__webpack_require__(5),ProModules=module_entry.ProModules,ProHttpDepends=module_entry.ProHttpDepends,ProOcxDepends=module_entry.ProOcxDepends,ModuleDepends=module_entry.ModuleDepends,DependencyMgr=new function(){var _that=this,DependencyModuleName="DependCollection",AfterAsyncLoadHasResult=function(e){var t=e.getPath();null==t?e.emit():AsyncLoadJsCss(t,AfterAsyncLoadHasResult,e)},AsyncLoadJsCss=function(e,t,n){var o=null,i=null;0<e.indexOf(".js")?((o=document.createElement("script")).src=e,i=DependencyMgr.GetJsEleContainer()):0<e.indexOf(".css")&&((o=document.createElement("link")).type="text/css",o.rel="stylesheet",o.href=e,i=document.head),o&&(o.onload=function(){t(n),"text/css"!=o.type&&o.parentElement.removeChild(o)},i.appendChild(o))},LoadJsOrScript=function(e,t,n){return!!window.XMLHttpRequest&&(AfterAsyncLoadHasResult({szPaths:e,index:0,lastIndex:0,getPath:function(){return this.index<this.szPaths.length?(this.lastIndex=this.index,this.index++,this.szPaths[this.lastIndex]):null},onResult:t,emit:function(){this.onResult&&this.onResult(this.tag)},tag:n}),!0)},ModuleInfo=function(e,t){this.names=e,this.promise=t,this.szNames=null},loadGetPaths=function(e,t){return new ModuleInfo(e,t).GetAbsPath()},loadDependsProxy=function(e,t,n,o){t=loadGetPaths(e,t);return LoadJsOrScript(t,n,o)},RegModule=function(e,t,n){return null==GetDependModuleCollection()[e]?(SetModuleReged(e,!0),n||ConsoleLogRegModel(e),GetDependModuleCollection()[e]=t):console.error("load dependency error"),t},ConsoleLogRegModel=function(e){console.log("[D] RegModule "+e)},GetDependModuleCollection=function(){return void 0===_that[DependencyModuleName]&&(_that[DependencyModuleName]={}),_that[DependencyModuleName]},GetModuleInfo=function(e){e+="_info";return void 0===GetDependModuleCollection()[e]&&(GetDependModuleCollection()[e]={}),GetDependModuleCollection()[e]},SetModuleInfo=function(e,t,n){GetModuleInfo(e)[t]=n},InjectModule=function(e,t){return t(e)},SyncGetModule=function(e){return _that[DependencyModuleName][e]},GetModuleEntiey=function(e,t){return void 0===_that[DependencyModuleName]&&(_that[DependencyModuleName]={}),_that[DependencyModuleName][t]},CheckModuleReged=function(e){return GetModuleInfo(e).bloaded},SetModuleReged=function(e,t){SetModuleInfo(e,"bloaded",t)},GetRegedModule=function(t,e,n){var o=GetModuleEntiey(DependencyModuleName,t);if(o&&CheckModuleReged(t))return InjectModule(o,n);loadDependsProxy([e],null,function(){var e=GetModuleEntiey(DependencyModuleName,t);InjectModule(e,n)},null)};function onLoadResultProxy(e,t){LoadModuleByModeleInfo(LoadModulesInfo,e,t)}this.jswGetDependUrl=function(e){return loadGetPaths([e="thlib/"+e])[0]},this.GetJsEleContainer=function(){return document.body},this.LoadProDepends=function(e,t){var n=ProModules.paths,o=ProModules.names;return loadDependsProxy(n,o,onLoadResultProxy(e,t),t)},this.LoadHttpDepends=function(e,t){var n=ProHttpDepends.paths;return loadDependsProxy(n,ProHttpDepends.promise,e,t)},this.LoadOcxDepends=function(e,t){var n=ProOcxDepends.paths;return loadDependsProxy(n,null,e,t)},this.loadDependsProxy=loadDependsProxy;var LoadModulesInfo={data:ModuleDepends.paths,iLoadIndex:0,tag:null,userData:null};function LoadModuleByModeleInfo(e,t,n){0==LoadModulesInfo.iLoadIndex&&(LoadModulesInfo.tag=t,LoadModulesInfo.userData=n),LoadModulesInfo.iLoadIndex<LoadModulesInfo.data.length?moduleInjectUtil(LoadModuleByModeleInfo,null,(n=LoadModulesInfo.data[LoadModulesInfo.iLoadIndex++])[0],1<n.length?n[1]:null):(LoadModulesInfo.iLoadIndex=0,LoadModulesInfo.tag&&LoadModulesInfo.tag(LoadModulesInfo.userData))}function moduleInjectUtil(e,t,n,o,i){if(i)return(t?e.bind(t):e)(),s;var s=GetRegedModule(n,"modules/"+(o||"")+n+".js",t?e.bind(t):e);return s}this.cmdParseInJect=function(e,t){return moduleInjectUtil(e,t,"CmdParse")},this.HandleResponseInJect=function(e,t){return moduleInjectUtil(e,t,"HandleResponse")},this.GetEmotionSync=function(){return SyncGetModule("ImEmotion")};var _jSWHostSaved=null;this.jSWGetHost=function(){if(_jSWHostSaved)return _jSWHostSaved;var e,t=document.getElementsByTagName("script"),n=null;for(e in t)if(0<=t[e].src.indexOf("jsw.js")){n=t[e];break}return n?_jSWHostSaved=n.src.split("jsw.js")[0]:(console.error("you can not modify the name of jsw.js, please check"),"")},ModuleInfo.prototype={dependencyRelativePath:"jswlib/",proJswPath:null,setProJswPath:function(e){this.proJswPath=e},GetAbsPath:function(){if(null==this.szNames){this.szNames=[];for(var e,t=0;t<this.names.length;t++)this.checkAllPromise(t)||(e=this.proJswPath+this.dependencyRelativePath+this.names[t],this.szNames.push(e))}return this.szNames},checkAllPromise:function(iIndex){var proExp="((typeof (pl) != 'undefined'))";return this.promise?(proExp=this.promise instanceof Array?proExp.replace("pl",this.promise[iIndex]):proExp.replace("pl",this.promise),eval(proExp)):!1}},ModuleInfo.prototype.setProJswPath(this.jSWGetHost()),this.RegModule=RegModule,this.CreateModule=function(e){var t={};return this.RegModule(e,t,!0),t},this.ClaimModule=function(e){var t=this.GetModule(e);return null==t&&(t=this.CreateModule(e),SetModuleReged(e,!1),console.log("[D] Claim Module: "+e)),t},this.RegClaimedModuleProxy=function(e,t){var n=this.GetModule(e);null==n&&(n=this.ClaimModule(e)),!CheckModuleReged(e)&&t&&(t(n),SetModuleReged(e,!0)),ConsoleLogRegModel(e)},this.RegClaimedModule=function(e,t){var n=this.GetModule(e);null==n&&(n=this.ClaimModule(e)),t&&(t.bind(n)(),n.__proto__=t.prototype),SetModuleReged(e,!0),ConsoleLogRegModel(e)},this.GetModule=function(e){return GetModuleEntiey("",e)}};jSW.jswGetDependUrl=DependencyMgr.jswGetDependUrl,jSW.DependencyMgr=DependencyMgr,module.exports={jSW:jSW,dMgr:DependencyMgr}},function(e,t){e.exports={ProModules:{paths:["thlib/jquery-1.8.2.min.js","bv.js","utils/Base64.js","utils/BigInt.js","utils/jn_rsa.js"],names:["jQuery","proto","Base64","biFromNumber","jnRSA"]},ProHttpDepends:{paths:["thlib/video.min.js","thlib/videojs-contrib-hls.min.js","thlib/videojs.zoomrotate.js","thlib/video-js.min.css","thlib/HttpFlv/codec/libffmpeg_265.js","thlib/HttpFlv/render/webgl.js","thlib/HttpFlv/flv.min.js","thlib/pcm/pcm-player.min.js"],promise:["bvVideojs","bvVideojshls","bvVideojszoomrotate","bvVideojs","Module","WebGLPlayer","flvjs","PCMPlayer"]},ProOcxDepends:{paths:["thlib/jquery-playbar.js","thlib/barstyle.css"]},ModuleDepends:{paths:[["jSWProtocol"],["jSWUtils"],["jswConst"],["CmdParse"],["ImEmotion"],["HandleResponse"],["Conference","Conference/"],["ImModule"],["HttpFlv"],["Audio","Audio/"],["AudioCapture","Audio/"],["AudioMgr","Audio/"],["HandleConfSpeak","Conference/"],["PuLoad"],["HTTPNruFile"]]}}},function(e,t,n){var n=n(0),r=n.jSW,s=n.jSWProtocol,a=n.jSWUtils,l=n.jSWOptions,u=n.PuLoad;n.AudioMgr,n.HTTPNruFile;r.CallProtoType={AUTO:0,OCX:1,HTTP:2,CheckOcx:function(e){return e==this.OCX}},r.OpenDebug=function(e){a._IsDebug=e},r._swOcxOnEvent=function(e,t){console.log("ocx on event rc:"+e+" websocket port: "+t);t=parseInt(t);(e!=r.RcCode.RC_CODE_S_OK||t<=0)&&console.error("ocx init fail "+e+" "+t),t<=0&&(e=r.RcCode.RC_CODE_E_INVALIDARG),l.ocxWebsocketPort=t,l.init_options.oninit&&"function"==typeof l.init_options.oninit&&(a._mMgr.bUseOcx()?setTimeout(l.init_options.oninit,50,e):l.init_options.oninit(e))},r._swOcxPlayerOnEvent=function(e,t){try{0==e&&t&&t._swOnDivSizeChange(-1)}catch(e){}},r.GetHttpVersion=function(e){return setTimeout(function(){e.callback(e,{},{szversionid:r.version.ReqOcxVer})},50),0},r.MessageType=null,r.RotateType=null,r.EventActions=null,r.swInit=function(e){return r.DependencyMgr.LoadProDepends(function(e){var t,n,o,i=(o={bocxws:!1,bNEGP:!1,bManualLP:!1,bAutoLoadOnlyOnlinePu:!1},(n=e)&&n.config&&(o.bocxws=!!n.config.bocxws,o.bNEGP=!!n.config.bNEGP,o.bManualLP=!!n.config.bManualLP,o.bAutoLoadOnlyOnlinePu=!!n.config.bAutoLoadOnlyOnlinePu),a._mMgr.setBUseOcxWs(o.bocxws),o);console.log("Start Jsw Init"),t={url:null,calltype:r.CallProtoType.AUTO,oninit:null,home:null},e=a.extend({},t,e||{}),n=e,o=0=="WebSocket"in window?(alert("not support websocket"),n.oninit&&"function"==typeof n.oninit&&n.oninit(r.RcCode.RC_CODE_E_INVALIDARG),r.RcCode.RC_CODE_E_INVALIDARG):(l.calltype=n.calltype,r.CallProtoType.AUTO==l.calltype&&(a.isIE()?l.calltype=r.CallProtoType.OCX:l.calltype=r.CallProtoType.HTTP),0==a.isIE()&&r.CallProtoType.OCX==l.calltype?(console.error("only ie support ocx!"),n.oninit&&"function"==typeof n.oninit&&n.oninit(r.RcCode.RC_CODE_E_INVALIDARG),r.RcCode.RC_CODE_E_INVALIDARG):(l.init_options=n,r.RcCode.RC_CODE_S_OK)),r.RcCode.bFaild(o)||(null==r.MessageType&&(r.MessageType=s.RequestHeader.notifys),null==r.RotateType&&(r.RotateType=s.RotateType),null==r.EventActions&&(r.EventActions=s.EVENTACTIONS),t=e,n=window.document.location.href,o=window.document.location.pathname,o=n.lastIndexOf(o),o=n.substring(0,o),null!=t.url&&0<t.url.length&&(o=t.url),null==t.home&&(t.home=o),t=0==o.indexOf("https")?"https://":"http://",l.http=o,l.url=o.replace(t,"")+"/jswapi",t=o.replace(t,"").split(":"),l.ip=t[0],0<l.url.indexOf(":")?l.port=t[1]:l.port=-1,r.CallProtoType.OCX==l.calltype?function(t){var n,o=document.getElementById("jsw_ocx");if(null==o){try{(o=document.createElement("object")).id="jsw_ocx",o.classid="clsid:51DF1D91-DA4E-47DA-A5BE-84A96ADD2425",o.width=1,o.height=1,o.style.position="absolute",o.style.top="0px",o.style.left="0px",document.body.appendChild(o)}catch(e){if(console.error("ocx attach exception "+e),(n=document.getElementById("jsw_ocx"))&&document.body.removeChild(n),r.CallProtoType.OCX==l.calltype)return t.oninit&&"function"==typeof t.oninit&&t.oninit(r.RcCode.RC_CODE_E_INVALIDARG),r.RcCode.RC_CODE_E_INVALIDARG;l.calltype=r.CallProtoType.HTTP}if(null!=o){try{var i=0,s=setInterval(function(){var e=o.oxGetWebSocketPort();0<e||20<i?(clearInterval(s),r._swOcxOnEvent(0,e)):i++},500)}catch(e){if((n=document.getElementById("jsw_ocx"))&&document.body.removeChild(n),document.body.removeChild(oScript),console.error("ocx add event exception "+e),r.CallProtoType.OCX==l.calltype)return t.oninit&&"function"==typeof t.oninit&&t.oninit(r.RcCode.RC_CODE_E_INVALIDARG),r.RcCode.RC_CODE_E_INVALIDARG;l.calltype=r.CallProtoType.HTTP}a._mMgr.RegOcxHandle(o)}}else t.oninit&&"function"==typeof t.oninit&&t.oninit(r.RcCode.RC_CODE_S_OK);r.DependencyMgr.LoadOcxDepends()}(e):l.calltype==r.CallProtoType.HTTP&&r.DependencyMgr.LoadHttpDepends(function(e){a.ActiveAMDOrModule(),e.oninit&&"function"==typeof e.oninit&&(e.oninit(r.RcCode.RC_CODE_S_OK),a.debugLogInfo("load video.js ok!"))},e),u.PuLoadInit(i))},e),0},r.swDeInit=function(){if(l.session_list&&0<l.session_list.length){for(var e=0;e<l.session_list.length;e++)l.session_list[e].swDispose(),delete l.session_list[e];l.session_list=[]}if(r.RcCode)return r.RcCode.RC_CODE_S_OK},r.swGetOption=function(){return{http:l.http,version:l.version,calltype:l.calltype}}},function(t,n,o){var o=o(0),d=o.jSW,p=o.jSWProtocol,h=o.jSWUtils,i=o.jSWOptions,s=o.PuLoad,r=(o.AudioMgr,o.HTTPNruFile);d.SWSession=function(e){d.swDeInit();e=h.extend({},{server:"127.0.0.1",port:9701,onopen:null,onclose:null},e||{}),d.SWSession._init(this,e),d.SWSession._CreateWs(this,e)},d.SWSession._GetSessionById=function(e){},d.SWSession._init=function(e,t){"string"==typeof t.server&&0==t.server.indexOf("!")?e._server=t.server.slice(1):e._server=i.ip!=t.server||h.isIE()?t.server:"127.0.0.1",e._port=Number(t.port),e._arr_pu=[],e._arr_pu_index=[],e._arr_pu_offline=[],e._arr_pu_online=[],e._arr_dialog=[],e._arr_record_play=[],e._p_emms=new proto.WEBBVCU.EmmsHeader,e._p_emms.setKey(i.appkey),e._p_emms.setVer(i.version),e._emms=new p.EmmsHeader(i.appkey,i.version),e._bLogout=!1,e._callbackManager=new d.SWCallbackManager(e,[p.RequestHeader.notifys.notify.cmd,p.RequestHeader.login.cmd,p.RequestHeader.keeplive.cmd,p.RequestHeader.logout.cmd,p.RequestHeader.pulist.cmd,p.RequestHeader.openchanle.cmd,p.RequestHeader.keeplivechanle.cmd,p.RequestHeader.closechanle.cmd,p.RequestHeader.pugpsdata.cmd,p.RequestHeader.lossconnection.cmd,p.RequestHeader.pugroup.cmd]),e._pusModule=new d.SWSession._SwPuModule(e),e._confManager=new d.SwConfManager(e),e._immodule=new d.SWSession.SwImModule(e,e._confManager,e._pusModule),e._userManager=new d.SwUserManager(e),e._commDlgMgr=new d.CommonDlgMgr(e)},d.SWSession._CreateWs=function(e,t){try{h._mMgr.loadWebSocket(function(t,n,e){try{var o=p.GetWsUrl();t._ws=new e(o),t._checkWsCreateResult(n)}catch(e){t._onWsError(n,e)}},e,t)}catch(e){return void this._onWsError(t,e)}},d.SWSession._SwPuModule=function(e){this._session=e},d.SWSession._SwPuModule.prototype={_onNotifyImMsg:function(e,t){var n=p.RequestHeader.confnotify.notifyimmsg.cmd,o={szSourceId:e.szSourceId,iSourceId:e.iSourceId};data={sender:o,szmsgs:e.szmsg},this._notifytouser(t,n,data)},_notifytouser:function(e,t,n){this._session._callbackManager.dispatchCallback("notify",{code:e.getCode(),response:e,msg:t,content:n})}},d.SWSession.prototype={swGetOnlineUsers:function(e){return p.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_USER_ONLINE,callback:e.callback,tag:e.tag})},swGetOnlineUsersClassified:function(i){return p.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_USER_ONLINE,callback:function(e,t,n){var o=null;t.emms.code==d.RcCode.RC_CODE_S_OK&&((o={userlist:null,pulist:null}).userlist=n.filter(function(e){return 0==e.devid.indexOf("UA_")}),o.pulist=n.filter(function(n){return 0==n.devid.indexOf("PU_")&&0==o.userlist.some(function(e){var t=!1;try{t=n.devid.split("_")[1]==e.devid.split("_")[1]}catch(e){console.error(e)}return t})}),o.userlist=n.filter(function(e){return 0==e.devid.indexOf("UA_")||0==e.devid.indexOf("CU_")}));n=p.BuildEventOptions(null,null,null,i.tag);i.callback(n,t,o)},tag:i.tag})},_OnOpenGpsChannel:function(e,t,n,o){e=this.swGetPu(e);!e||(t=e.swGetChanel(t))&&t._OnOpenGpsHasResult(n,o)},_OnNotifyGpsData:function(e,t,n){e=this.swGetPu(e);!e||(t=e.swGetChanel(t))&&t._tickGpsData(n)},_checkWsCreateResult:function(t){null==this._ws?(console.error("http websoket error null"),this._onWsError(t,e)):(this._onWsCreateOk(t),h._mMgr.oWsOpen(this._ws))},_onServerDisconnect:function(){this._releaseActiveChannel(),this._callbackManager.dispatchCallback(p.RequestHeader.lossconnection.cmd,{code:0,response:{},msg:p.RequestHeader.lossconnection.cmd,content:null})},_onWsCreateOk:function(e){-1==i.session_list.indexOf(this)&&i.session_list.push(this);var n=this,o=e;console.log("websoket connect ..."),this._ws.onopen=function(){console.log("http websoket connect success!"),o.onopen&&"function"==typeof o.onopen&&o.onopen(n)},this._ws.onerror=function(e){n._ws=null,n._onWsError(o,e)},this._ws.onmessage=function(e){p.txOnResponse(-1,e.data)},this._ws.onclose=function(e){n._ws=null,console.log("http websoket connect closed:"+e.code+" reason: "+e.reason),this._doReconnect(function(){n.swLogout()}),o.onclose&&"function"==typeof o.onclose&&o.onclose(n,e)},this._ws._doReconnect=function(e){var t;0==n._bLogout?0<n._emms.session.length?(console.log("session stay login"),0<(t=this._time_last_check())?(console.log("test then should reconnect"),this._doReconnectTimerAction(n,t,function(e){e._statusReset()})):(console.log("try login spend too much time, endpoint of server maybe released. stop reconnecting and notify caller"),this._statusReset(),e())):console.log("session did not login, should not reconnect"):(console.log("session has logout, should not reconnect"),this._statusReset())},this._ws._time_last_check=function(){var e=n._serverConfig.sessionidletime/1e3;return void 0===o._reConnectTimes?1+e:e-(Date.parse(new Date)/1e3-o._reConnectTimes)},this._ws._statusReset=function(){o._reConnectTimes=-1,o._extendTag&&(o=o._extendTag)},this._ws._doReconnectTimerAction=function(t,e,n){console.log("timer ticked, try to reconnect"),-1==(o=o&&void 0===o._bReConnect?{_reConnectTimes:-1,_bReConnect:!0,_extendTag:o,onopen:function(e){console.log("connected to ws server, reset connect times"),n(t._ws),p.SendRequest({session:e,msgtype:proto.WEBBVCU.MSGType.WEB_REREG_WEBSOCKET_COMMAND})}}:o)._reConnectTimes&&(o._reConnectTimes=Date.parse(new Date)/1e3),setTimeout(function(e){d.SWSession._CreateWs(e,o)},1e3,t),console.log("timer reconnect action "+e)},this._ws._doCheckBReconnect=function(){return!(!o||!o._bReConnect)}},_onWsError:function(e,t){console.error("http websoket error"+t),e.onclose&&"function"==typeof e.onclose&&e.onclose(this,t)},swSetGlobalControlParam:function(e){var t=d.RcCode.RC_CODE_E_UNSUPPORTED;if(i.CheckOcx()){if(null==typeof e.Idelayvssmooth)return d.RcCode.RC_CODE_E_INVALIDARG;var n=new proto.WEBBVCU.ParamsDialogControl;return n.setIdelayvssmooth(e.Idelayvssmooth),t=p.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_GLOBAL_DIALOG_PARAM,payload:n,callback:e.callback,tag:e.tag})}return t},swImSend:function(e){if(!e.msgitems){if(!e.filepath)return d.RcCode.RC_CODE_E_BVCU_INVALIDARG;if(!e.targetid||-1==e.targetid.indexOf("PU"))return console.log("target id invalidarg"),d.RcCode.RC_CODE_E_BVCU_INVALIDARG;e.msgitems=[{nruid:"NRU_",iType:p.IMMSGTypes.FILE,data:e.filepath}]}return void 0===e.iapplierid&&(e.iapplierid=0),this._immodule._swConfIMSend(e,proto.WEBBVCU.MSGType.WEB_BVCU_CONF_IM_MSG)},swImRecv:function(e){return e.targetid&&-1!=e.targetid.indexOf("PU")?(e.msgitems=[{nruid:e.nruid,iType:p.IMMSGTypes.FILE,data:e.remotepath}],this._immodule._SwConfFileRecv(e)):(console.log("target id invalidarg"),d.RcCode.RC_CODE_E_BVCU_INVALIDARG)},_swIMSendCommon:function(e){var t=e.argsCallback();return p.SendRequest({target:e.puid,session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_CONF_IM_MSG,payload:t,callback:e.callback,tag:e.tag})},swOpenFileInDir:function(e){if(i.calltype!=d.CallProtoType.OCX)return d.RcCode.RC_CODE_E_BVCU_UNSUPPORTED;if(d.CallProtoType.OCX!=i.calltype)return d.RcCode.RC_CODE_E_FAIL;var t=e.szFilePath;return p.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_UTILS_OPEN_FILE_IN_DIR,payload:t,callback:e.callback,tag:e.tag})},_send:function(e){var t=this._ws;if(null==t)return console.error("websocket is null, current calltype "+(i.CheckOcx()?"ocx":"http")),d.RcCode.RC_CODE_E_DISCONNECTED;if(this._ws.OPEN||(this._ws.OPEN=1),t.readyState!=this._ws.OPEN)return console.warn("websocket not connection"),d.RcCode.RC_CODE_E_DISCONNECTED;if(this._bLogout)return d.RcCode.RC_CODE_E_BVCU_DISCONNECTED;try{return t.send(e),d.RcCode.RC_CODE_S_OK}catch(e){return d.RcCode.RC_CODE_E_DISCONNECTED}},swAddCallBack:function(e,t){return this._callbackManager.addCallback(e,t),d.RcCode.RC_CODE_S_OK},swGetVersion:function(e){if(i.CheckHttp())return setTimeout(function(){e.callback(e,{},{szprototype:"HTTP",szversionid:d.version.SdkVer})},50),n;var t=new proto.WEBBVCU.Request;t.setMsgtype(proto.WEBBVCU.MSGType.WEB_GET_VERSION_INFO),t.setEmms(this._p_emms);var n=p._internalSend({session:this,request:t,callback:e.callback,enforce:!0});return n},swLogin:function(i){i=h.extend({},{user:"",password:""},i||{}),this._user=i.user;var e=new proto.WEBBVCU.Request;return e.setMsgtype(proto.WEBBVCU.MSGType.WEB_BVCU_GET_PUBKEY),e.setEmms(this._p_emms),p._internalSend({cmd:p.RequestHeader.pubkey.cmd,session:this,request:e,callback:function(e,t){e.tag,t.url;var n,o=e.request;(n=e.session).p_options=e,(n.p_response=t).getCode()==d.RcCode.RC_CODE_S_OK&&(t=t.getPayload(),t=proto.WEBBVCU.PublicKey.deserializeBinary(t),this.pubkey_d=t.getD(),this.pubkey_n=t.getN(),n=e.session,(o=new proto.WEBBVCU.Request).setMsgtype(proto.WEBBVCU.MSGType.WEB_BVCU_LOGIN),o.setEmms(n._p_emms),(e=new proto.WEBBVCU.BVCU_LOGIN).setServer(n._server),e.setPort(Number(n._port)),e.setUser(i.user),e.setPassword(i.password),o.setPayload(e.serializeBinary()),p._internalSend({cmd:p.RequestHeader.login.cmd,session:n,request:o}),console.log("login info:"+n._server+":"+n._port+"user"+i.user))}})},swLogout:function(){this._releaseActiveChannel(),this._arr_pu_index=[],this._arr_pu.splice(0,this._arr_pu.length),this._arr_dialog.splice(0,this._arr_dialog.length),this._timer_keeplive&&(clearInterval(this._timer_keeplive),this._timer_keeplive=null);for(var e=new p.JsonParamNoAttach(this._p_emms,proto.WEBBVCU.MSGType.WEB_BVCU_LOGOUT),e=p._internalSend({cmd:p.RequestHeader.logout.cmd,session:this,request:e}),t=i.session_list,n=0,n=0;n<t.length;n++)if(t[n]==this){i.session_list.splice(n,1),this._bLogout=!0;break}return null!=this._confManager&&(this._confManager._clear(),this._confManager=null),this._confManager=null,this._immodule=null,this._pusModule=null,this._commDlgMgr=null,this._userManager._clear(),this._userManager=null,this._arr_pu=null,this._arr_pu_index=null,this._arr_pu_offline=null,this._arr_pu_online=null,this._arr_dialog=[],this._arr_record_play=[],this._p_emms=null,this._emms=null,this._serverConfig=null,this.p_options=null,this.p_response=null,this.swDispose(),e},_releaseActiveChannel:function(){for(var e=0;e<this._arr_dialog.length;e++)this._arr_dialog[e].swClose();for(e=0;e<this._arr_pu.length;e++)this._arr_pu[e]._clear()},swKeepLive:function(){p.RequestHeader.keeplive;var e=new p.JsonParamNoAttach(this._p_emms,proto.WEBBVCU.MSGType.WEB_BVCU_KEEPALIVE),e=p._internalSend({cmd:p.RequestHeader.keeplive.cmd,session:this,request:e});return console.log("keeplive session: "+this._server+" "+this._port),e},swGetPuList:function(e){return this._AutoReqSendProxy(e,{status:3,pagesize:0,page:0},function(e){e=p.ParamPuList(e.status,e.pagesize,e.page);return{msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SEARCH_GET_PULIST,target:"CMS_",payload:e,cmd:p.RequestHeader.pulist.cmd}})},swSearchPuList:function(e){return s.SearchGetPulist(e,e.callback,e.tag)},_swAsyncGetPu:function(e){if(!e.szpuid||0==e.szpuid.length)return d.RcCode.RC_CODE_E_INVALIDARG;e=this._AutoReqSendProxy(e,{},function(e){return{msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_PUINFO_BY_PUID,target:e.szpuid}});return console.log("async get pu list"),e},_AutoReqSendProxy:function(e,t,n){d.RcCode.RC_CODE_E_FAIL;t={session:this,msgtype:-1,target:"",targetIndex:-1,payload:null,cmd:"",callback:(e=h.extend({},t=t||{},(e=e||{})||{})).callback||null,tag:e.tag||null},e=n.bind(this)(e),e=h.extend({},t,e||{});return p.SendRequest(e)},swSearch:function(e){return this._searchFile(e,"NRU_")},swDownFileFromNru:function(e){return e=h.extend({},{pcallback:null},e||{}),this._swDownFileSearch({szRFP:e.remoteFilePath,szLFD:e.localFileDir,szTargetId:e.szNRUID,msgType:proto.WEBBVCU.MSGType.WEB_BVCU_DOWN_FILE_ONNRU,callback:e.callback,callbackrelay:e.pcallback,tag:e.tag})},_searchFile:function(e,t){var n={stSearchInfo:{iType:1,iPostition:0,iCount:50},stFilter:{szPUID:"",iChannelIndex:-1,iFileType:0,iTimeCondition:0,iTimeBegin:0,iTimeEnd:0,iFileSizeMin:0,iFileSizeMax:0,iRecordType:0,szDesc1:"",szDesc2:"",filename:"",userid:""},callback:null,tag:null};(e=h.extend({},n,e||{})).stSearchInfo=h.extend({},n.stSearchInfo,e.stSearchInfo||{}),e.stFilter=h.extend({},n.stFilter,e.stFilter||{});n=p.ParamSearchList(e.stSearchInfo,e.stFilter);return p.SendRequest({cmd:p.RequestHeader.searchlist.cmd,session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_SEARCH_LIST,target:t,payload:n,callback:e.callback,tag:e.tag})},swDelRecordFileFilter:function(e){var t={stFilter:{szPUID:"",iChannelIndex:-1,iFileType:0,iTimeCondition:0,iTimeBegin:0,iTimeEnd:0,iFileSizeMin:0,iFileSizeMax:0,iRecordType:0,szDesc1:"",szDesc2:""},callback:null,tag:null};(e=h.extend({},t,e||{})).stFilter=h.extend({},t.stFilter,e.stFilter||{});var n,o,i,t=(n=e.stFilter,o=new proto.BVCU.NRUConfig.DeleteFileReq,(i=new proto.BVCU.Search.Search_FileFilter).setSzpuid(n.szPUID),i.setIchannelindex(n.iChannelindex),i.setIfiletype(n.iFileType),i.setItimebegin(n.iTimeBegin),i.setItimeend(n.iTimeEnd),i.setIfilesizemin(n.iFileSizeMin),i.setIfilesizemax(n.iFileSizeMax),i.setIrecordtype(n.iRecordType),i.setSzdesc1(n.szDesc1),i.setSzdesc2(n.szDesc2),i.setItimecondition(n.iTimeCondition),o.setItype(1),o.setIcount(1),o.addStfilefilters(i),o);return p.SendRequest({cmd:p.RequestHeader.recordfile_del.cmd,session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_RECORDFILE_DELETE,payload:t,callback:e.callback,tag:e.tag})},swDelRecordFileFilterId:function(e){(e=h.extend({},{stFileIds:[],callback:null,tag:null},e||{})).stFileIds||(e.stFileIds=[]);var t=function(e){var t=new proto.BVCU.NRUConfig.DeleteFileReq;t.setItype(2);for(var n=0;n<e.length;n++){var o=new proto.BVCU.NRUConfig.FileID;o.setSzsourceid(e[n].nruid),o.addIrecordid(e[n].recordid),t.addStfileidfilters(o)}return t}(e.stFileIds);return p.SendRequest({cmd:p.RequestHeader.recordfile_del.cmd,session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_RECORDFILE_DELETE,payload:t,callback:e.callback,tag:e.tag})},swSearchFileOnPu:function(e){return null==e||null==e.stFilter||null==e.stFilter.szPUID||0==e.stFilter.szPUID.length?(console.warn("bad args, please check!"),d.RcCode.RC_CODE_E_FAIL):this._searchFile(e,e.stFilter.szPUID)},swDownFileFromPu:function(e){return e=h.extend({},{pcallback:null},e||{}),this._swDownFileSearch({szRFP:e.remoteFilePath,szLFD:e.localFileDir,szTargetId:e.szPUID,msgType:proto.WEBBVCU.MSGType.WEB_BVCU_DOWN_FILE_ONPU,callback:e.callback,callbackrelay:e.pcallback,tag:e.tag})},_swDownFileSearch:function(e){var t=d.RcCode.RC_CODE_E_FAIL;if(i.CheckNotOcx())t=r.DownloadToLocal(e.szTargetId,e.szRFP),e.callback&&e.callback({tag:e.tag},{emms:{code:t}});else{if(i.calltype!=d.CallProtoType.OCX)return alert("Just OCX support!!"),d.RcCode.RC_CODE_E_FAIL;if(null==e||null==e.szTargetId||0==e.szTargetId.length||null==e.szRFP||0==e.szRFP.length||null==e.szLFD||0==e.szLFD.length)return console.warn("bad args, please check!"),d.RcCode.RC_CODE_E_FAIL;var n=new proto.WEBBVCU.DownFileFromPu,o=e.szRFP;0==e.szTargetId.indexOf("NRU")&&(o=e.szRFP.replace(/\//g,"\\")),n.setSzremotefilepathname(o),n.setSzlocalfilepathname(e.szLFD),t=p.SendRequest({session:this,msgtype:e.msgType,target:e.szTargetId,payload:n,callback:e.callback,callbackrelay:e.callbackrelay,tag:e.tag})}return t},swSearchGpsV2:function(e){var t=new p.BVCU_Search_FileFilter(e.szPuid,-1,e.iTimeBegin,e.iTimeEnd,4,0,0,0);return this.swSearch({stSearchInfo:e.stSearchInfo,stFilter:t,callback:e.callback,tag:e.tag})},swGetGpsRecordDataV2:function(e){return this._swGetGpsRecordData(e,proto.WEBBVCU.MSGType.WEB_BVCU_DOWNLOAD_GPS_RECORD_SERVERC)},swSearchGps:function(e){if(i.calltype!=d.CallProtoType.OCX)return alert("Just OCX support!!"),d.RcCode.RC_CODE_E_FAIL;if(null==e.szNruId||0==e.szNruId.length)return console.warn("nruid should be invalid!"),d.RcCode.RC_CODE_E_FAIL;if(null==e.iTimeBegin||null==e.iTimeEnd)return console.warn("time slice should be invalid!"),d.RcCode.RC_CODE_E_FAIL;if(null==this._swGetPu(e.szPuid)||null==e.szPuid||0==e.szPuid.length)return console.warn("puid should be invalid!"),d.RcCode.RC_CODE_E_FAIL;if(e.iTimeBegin=Number(e.iTimeBegin),e.iTimeEnd=Number(e.iTimeEnd),e.iTimeBegin>=e.iTimeEnd)return console.warn("time slice should be invalid!"),d.RcCode.RC_CODE_E_FAIL;var t=new proto.WEBBVCU.RecordFileFilter;return t.setSzpuid(e.szPuid),t.setItimebegin(e.iTimeBegin),t.setItimeend(e.iTimeEnd),p.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_GPS_RECORD,target:e.szNruId,payload:t,callback:e.callback,tag:e.tag})},swGetGpsRecordData:function(e){return this._swGetGpsRecordData(e,proto.WEBBVCU.MSGType.WEB_BVCU_DOWNLOAD_GPS_RECORD,!0)},_swGetGpsRecordData:function(c,e,t){return t&&i.CheckNotOcx()?(alert("Just OCX support!!"),d.RcCode.RC_CODE_E_FAIL):null==c.szNruId||0==c.szNruId.length?(console.warn("nruid should be invalid!"),d.RcCode.RC_CODE_E_FAIL):null==c.szFilePath||0==c.szFilePath.length?(console.warn("file path should be invalid!"),d.RcCode.RC_CODE_E_FAIL):(i.CheckNotOcx()?r.Download(c.szNruId,c.szFilePath,0,function(e,t,n){var o=[];if(200==e){t=(new DOMParser).parseFromString(p.LargeHexToString(t),"application/xml");console.log(t);for(var i,s,r=null,a=t.children[0].children,l=0;l<a.length;l++)if(r={},1!=(i=a[l]).attributes.length){for(var u=0;u<i.attributes.length;u++)s=Number(i.attributes[u].nodeValue),Number.isNaN(s)?r[i.attributes[u].nodeName]=i.attributes[u].nodeValue:r[i.attributes[u].nodeName]=s;r.long=r.lng,o.push(r)}}c.callback&&(e=200==e?d.RcCode.RC_CODE_S_OK:d.RcCode.RC_CODE_E_FAIL,c.callback({tag:c.tag},{emms:{code:e}},{fileinfo:{},gpsdata:{szgpspoint:o},data:o}))},null):(n=new proto.WEBBVCU.FTPFileInfo,t=c.szFilePath.replace(/\//g,"\\"),n.setSzfilepath(h.string2Uint8Array(t)),n=p.SendRequest({session:this,msgtype:e,target:c.szNruId,payload:n,callback:c.callback,tag:c.tag})),n);var n},swGetNruList:function(e){return p.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_NRU_LIST,callback:e.callback,tag:e.tag})},swGetRecordPlayer:function(e){for(var t=0;t<this._arr_record_play.length;t++)if(player=this._arr_record_play[t],player&&player._dialog_id==e)return player;return console.log("swGetRecordPlayer not found, dialogId: "+e),null},_swGetRecordPlayer:function(e){for(var t=0;t<this._arr_record_play.length;t++)if(player=this._arr_record_play[t],player&&player._player_id==e)return player;return console.log("_swGetRecordPlayer not found, playerId: "+e),null},_swDelRecordPlayer:function(e){for(var t=0;t<this._arr_record_play.length;t++)if(player=this._arr_record_play[t],player&&player._dialog_id==e)return!(this._arr_record_play[t]=null);return!1},swRecordPlayCtrl:function(e){e=h.extend({},{cmdtype:"PLAY",dialogId:0,ntp_begin:-1,ntp_end:-1,scale:-1,callback:null,tag:null},e||{});var t=new proto.WEBBVCU.MSG_WEB_BVCU_RECORD_PLAY_CRTL;return t.setCmdtype(e.cmdtype),t.setDialogid(e.dialogId),t.setNtpBegin(e.ntp_begin),t.setNtpEnd(e.ntp_end),t.setScale(e.scale),p.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_RECORD_PLAY_CRTL,cmd:p.RequestHeader.recordplay.play.cmd,target:e.dialogId,payload:t,callback:e.callback,tag:e.tag})},swRecordPlay:function(a){if(i.calltype!=d.CallProtoType.OCX)return alert("Just support ocx Video!!"),d.RcCode.RC_CODE_E_BVCU_BADSTATE;if(null==(a=h.extend({},{url:null,nru:null,video:!0,audio:!0,callback:null,div:null,time_begin:-1,time_end:-1,bWindowless:!1},a||{})).url||0==a.url.length)return console.error("url error: "+a.url),d.RcCode.RC_CODE_E_INVALIDARG;var l=null;"string"==typeof a.div&&(a.div=document.getElementById(a.div));var u=a.div;if(null==u)return console.error("no have div"),d.RcCode.RC_CODE_E_INVALIDARG;void 0===u.bv_uuid&&(u.bv_uuid=h.generateUUID());var e,c=null,t=u.bv_uuid+"_0077554",n=t+"tempdiv";null==(c=document.getElementById(t))?((e=null)==(n=document.getElementById(n))&&((n=document.createElement("div")).id=t+"tempdiv",n.style.width="100%",n.style.height="calc(100% - 20px)",(e=document.createElement("div")).id=t+"tempdiv_playbar",e.style.width="100%",e.style.backgroundColor="#555",n.databardiv=e),n.style.display="block",e=n.databardiv,u.appendChild(n),u.appendChild(e),(l=new jQuery.TigerPlayer).addBar($("#"+e.id),6e4,function(e){e.swPlay()},function(e){e.swPause()},function(e){e.swClose()},function(e,t){e.swJump({ntp_begin:t})}),(c=d.SWVideoChanel._Ocx_PlayObjMgr.GetPlayObj(a.bWindowless)).tag=this,c.id=t,n.appendChild(c),isNeedDelay=!0,e=t+"script_handler",null==(n=document.getElementById(e))&&((n=document.createElement("script")).id=e,n.type="text/javascript",n.setAttribute("for",t),n.setAttribute("event","OnHwndEvent(hwnd, ieventtype, pParam)"),n.text="jSW._swOcxPlayerOnEvent(ieventtype, this.tag);",document.body.appendChild(n),u.bv_playBackOScriptId=e,u.playObjectId=t),c.data_player_bar=l):(l=c.data_player_bar,console.warn("have element : "+t));var _=this;return setTimeout(function(){var e,t,n,o,i,s,r;e=_,t=a,n=c,o=u,i=l,s=h.generateUUID(),(r=new proto.WEBBVCU.MSG_WEB_BVCU_RECORD_PLAY).setFilepath(t.url),r.setNruid(t.nru),r.setVideo(t.video?1:0),r.setAudio(t.audio?1:0),r.setBwindowless(t.bWindowless),r.setStarttime(0),r.setEndtime(-1),r.setHwnd(0),r.setAutoplay(0),r.setPlayerId(s),null!=n?(r.setHwnd(n.GetWMHwnd()),n.style.display="block"):console.error("p_playObject is null"),p.SendRequest({session:e,payload:r,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_RECORD_PLAY,callback:t.callback,tag:t.tag})==d.RcCode.RC_CODE_S_OK&&(t=new d.SWPlayer(e,{playerId:s,nruId:t.nru,file:t.url,dialogId:-1,parentDiv:o,time_begin:t.time_begin,time_end:t.time_end,bar:i,callback:t.closecallback,tag:t.closetag}),e._arr_record_play.push(t))},500),d.RcCode.RC_CODE_S_OK},swVodVideo:function(e){if(i.calltype==d.CallProtoType.OCX)return alert("Just Http support Vod Video!!"),d.RcCode.RC_CODE_E_BVCU_BADSTATE;if(null==(e=h.extend({},{url:null,callback:null,tag:null},e||{})).url||0==e.url.length)return console.error("url error: "+e.url),d.RcCode.RC_CODE_E_INVALIDARG;var t=e.div;if("string"==typeof t&&(t=document.getElementById(t),console.log(typeof t)),null==t)return console.error("no have div"),d.RcCode.RC_CODE_E_INVALIDARG;void 0===t.bv_uuid&&(t.bv_uuid=h.generateUUID());var n=t.bv_uuid+"_0077553";return playObject=document.getElementById(n),null==playObject?(playObject=document.createElement("VIDEO"),playObject.setAttribute("id",n),playObject.setAttribute("class","bvvideo-js vjs-default-skin vjs-big-play-centered"),playObject.setAttribute("controls",!0),playObject.style.width="100%",playObject.style.height="100%",playObject.style.display="block",playObject.src=e.url,t.appendChild(playObject)):playObject.src=e.url,e.callback&&setTimeout(e.callback,50,{tag:e.tag},{emms:{code:d.RcCode.RC_CODE_S_OK}}),d.RcCode.RC_CODE_S_OK},swVodVideoEx:function(e){return d.RcCode.RC_CODE_E_UNSUPPORTED},swGetConfManager:function(){return this._confManager},swGetUserManager:function(){return this._userManager},swGetPu:function(e){var t=this._swGetPu(e);return t||this._swAsyncGetPu({szpuid:e}),t},_swGetPu:function(e){e=this._swGetPuFromArr(e,this._arr_pu);return-1==e?null:this._arr_pu[e]},_swGetPuFromArr:function(e,t){for(var n=0;n<t.length;n++)if(t[n]._id_pu==e)return n;return-1},_swCheckPuArr:function(e){var t=this._swGetPuFromArr(e._info_pu.id,this._arr_pu_offline),n=this._swGetPuFromArr(e._info_pu.id,this._arr_pu_online);0==e._info_pu.onlinestatus?(-1!=n&&this._arr_pu_online.splice(n,1),-1==t&&this._arr_pu_offline.push(e)):1==e._info_pu.onlinestatus&&(-1==n&&this._arr_pu_online.push(e),-1!=t&&this._arr_pu_offline.splice(t,1))},swGetPuChanel:function(e,t){e=this._swGetPu(e);return e?e.swGetChanel(t):null},swGetPuDeviceInfo:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_DEVICEINFO,p.RequestHeader.pucfg.getpudeviceinfo.cmd,this,null)},swSetPuDeviceInfo:function(e){dft_poptions={ilanguage:1,name:"default name"},e=h.extend({},dft_poptions,e||{});var t=new proto.BVCU.PUConfig.DeviceInfo;return t.setSzid(e.puid),t.setIlanguageindex(e.ilanguage),t.setSzname(e.name),t.setIputype(0),p.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_PU_DEVICEINFO,cmd:p.RequestHeader.pucfg.getpudeviceinfo.cmd,target:e.puid,payload:t,callback:e.callback,tag:e.tag})},swGetPuDeviceTime:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_DEVICETIME,p.RequestHeader.pucfg.getpudevicetime.cmd,this,null)},swGetPuEthernet:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_ETHERNET,p.RequestHeader.pucfg.getpuethernet.cmd,this,null)},swGetPuRadioNetwork:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_RADIONETWORK,p.RequestHeader.pucfg.getpuradionetwork.cmd,this,null)},swGetPuWifi:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_WIFI,p.RequestHeader.pucfg.getpuwifi.cmd,this,null)},swGetPuPower:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_POWER,p.RequestHeader.pucfg.getPuPower.cmd,this,null)},swGetPuOnlineControl:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_ONLINECONTROL,p.RequestHeader.pucfg.getPuOnlineControl.cmd,this,null)},swGetPuUpdateStatus:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_UPDATESTATUS,p.RequestHeader.pucfg.getPuUpdateStatus.cmd,this,null)},swGetPuLinkactionList:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_LINKACTION_LIST,p.RequestHeader.pucfg.getPuLinkactionList.cmd,this,null)},swGetLinkActionInfo:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_LINKACTION_LIST,p.RequestHeader.pucfg.getPuLinkactionList.cmd,this,e.linkactionbaseinfo)},swGetPuCarInfo:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_CARINFO,p.RequestHeader.pucfg.getPuCarInfo.cmd,this,null)},swGetPuZfyInfo:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_ZFYINFO,p.RequestHeader.pucfg.getPuZfyInfo.cmd,this,null)},swSetPuZfyInfo:function(e){dft_poptions={serial:"default",userno:"default",userame:"default",description:"default",unitno:"default",unitname:"default",defaultconference:""},e=h.extend({},dft_poptions,e||{});var t=new proto.BVCU.PUConfig.ZFYInfo;return t.setSzserial(e.serial),t.setSzuserno(e.userno),t.setSzusername(e.userame),t.setSzuserdescribe(e.description),t.setSzunitno(e.unitno),t.setSzunitname(e.unitname),t.setSzdefaultconference(e.defaultconference),p.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_PU_ZFYINFO,cmd:p.RequestHeader.pucfg.setPuZfyInfo.cmd,target:e.puid,payload:t,callback:e.callback,tag:e.tag})},swGetPuServers:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_SERVERS,p.RequestHeader.pucfg.getPuServers.cmd,this,null)},_swGetPuOperation:function(e,t,n,o,i){i=p.JsonParamCommand(this._p_emms,t,p.BVCU_Command(e.puid,-1,i));return p._internalSend({cmd:n,session:o,request:i,callback:e.callback,tag:e.tag})},swLogQuery:function(e){return d.DependencyMgr.cmdParseInJect(function(){this._swLogQuery(e)},this)},swPuLoginLogQuery:function(e){return this._swLogQueryOnOffline(e)},_swLogQuery:function(e){e=h.extend({},{ipostition:0,icount:120,itimebegin:0,itimeend:0,username:"",targetid:"",itargetindex:-1,callback:null,tag:null},e||{});var t=new proto.BVCU.Search.Search_Request,n=new proto.BVCU.Search.SearchInfo;t.setStsearchinfo(n),n.setItype(p.SearchType.OPERATE),n.setIcount(Number(e.icount)),n.setIpostition(Number(e.ipostition));var o=new proto.BVCU.Search.Search_OperateLog;if(t.setStoperatefilter(o),o.setSzusername(e.username),o.setSztargetid(e.targetid),0!=e.itimebegin&&0!=e.itimeend&&e.itimeend<e.itimebegin)return console.error("get operate log utc time error please check!"),d.RcCode.RC_CODE_E_FAIL;o.setIoperatetime(e.itimebegin),o.setItimeend(e.itimeend);n=Number(e.itargetindex);return null!=n&&0<=n&&o.setItargetindex(n),o.serializeBinary(),p.SendRequest({session:this,targetIndex:n,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_SEARCH_OPERATE,payload:t,callback:e.callback,tag:e.tag})},_swLogQueryOnOffline:function(n){n=h.extend({},{filter:{},callback:null,tag:null},n||{});var e=new proto.BVCU.Search.Search_Request,t=new proto.BVCU.Search.SearchInfo;e.setStsearchinfo(t),t.setItype(p.SearchType.PU_LOGIN),t.setIcount(Number(n.icount)),t.setIpostition(Number(n.ipostition));var o=new proto.BVCU.Search.Search_PULoginLog;e.setStpuloginlogfilter(o);for(var i=["setSzpuid","setSzip","setIport","setIapplierid","setIonlinetime","setIofflinetime"],s=0;s<i.length;s++){let e=i[s],t=e.slice(3);var r=n.filter[t];r&&(0==t.indexOf("I")?o[e](Number(r)):0==t.indexOf("Sz")&&o[e](r))}return p.SendRequest({session:this,targetIndex:-1,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_SEARCH_ONOFFLINE,payload:e,callback:n.callback,tag:n.tag})},swGetHistoryIM:function(e){var t=new proto.BVCU.Search.Search_Request,n=new proto.BVCU.Search.SearchInfo,o=new proto.BVCU.Search.Search_IMMsgFilter;if(void 0===e.stSearchInfo)return d.RcCode.RC_CODE_E_INVALIDARG;var i=e.stSearchInfo;if(n.setIcount(Number(i.iCount)),n.setIpostition(Number(i.iPostition)),n.setItype(9),void 0===e.stFilter)return d.RcCode.RC_CODE_E_INVALIDARG;i=e.stFilter;return void 0!==i.senderDevId&&o.setSzsenddevid(i.senderDevId),void 0!==i.senderUserId&&o.setSzsenduserid(i.senderUserId),void 0!==i.confId&&o.setSzconfid(i.confId),void 0!==i.recvDevId&&o.setSzrecvdevid(i.recvDevId),void 0!==i.recvUserId&&o.setSzrecvuserid(i.recvUserId),void 0!==i.szCallID&&o.setSzcallid(i.szCallID),void 0!==i.iStartTime&&o.setIstarttime(Number(i.iStartTime)),void 0!==i.iEndTime&&o.setIendtime(Number(i.iEndTime)),void 0!==i.iHasBeenRecv&&(-1==i.iHasBeenRecv?o.setIhasbeenrecv(Math.pow(2,32)-1):o.setIhasbeenrecv(i.iHasBeenRecv)),void 0!==i.iMsgType&&o.setImsgtype(Number(i.iMsgType)),void 0!==i.iOption&&o.setIoption(Number(i.iOption)),void 0!==i.content&&o.setStmsgcontent(i.content),t.setStsearchinfo(n),t.setStimmsgfilter(o),payload=t,p.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SEARCH_IM_MSG,payload:payload,callback:e.callback,tag:e.tag})},swGetPuGroupList:function(e){var t=d.RcCode.RC_CODE_E_UNSUPPORTED;return i.CheckOcx()?t:void 0===e?(console.error("params not set"),d.RcCode.RC_CODE_E_INVALIDARG,t):void 0===e.callback||"function"!=typeof e.callback?(console.error("callbak not set"),d.RcCode.RC_CODE_E_INVALIDARG,t):p.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_GROUPLIST,callback:e.callback,tag:e.tag})},swPuGroupFillGroupList:function(o){this.swGetPuGroupList({callback:function(e,t,n){e.tag.__swPuGroupFillGroupList(o,n)},tag:this})},__reStrcutGroup:function(e){var t,n=[],o=[];for(t in e)(""==e[t].szparentid?n:o).push(e[t]);var l=function(e,t){var n,o,i,s=null;for(i in e){n=(s=e[i]).szid,s.items=[];var r,a=[];for(r in t)(o=t[r])&&n==o.szparentid&&(s.items.push(o),t[r]=null,a.push(o));l(a,t)}};return l(n,o),n},__swPuGroupFillGroupList:function(h,e){var t=d.RcCode.RC_CODE_E_UNSUPPORTED;if(i.CheckOcx())return t;if(void 0===h.callback||"function"!=typeof h.callback)return console.error("callbak not set"),d.RcCode.RC_CODE_E_INVALIDARG,t;var g="boolean"==typeof h.bDoNotFilterEmptyGroup&&h.bDoNotFilterEmptyGroup,f=h.filterCallback,C=h.filterListCallback;let m=this._loopFilterNULLPuGroup.bind(this);if(void 0===h)return console.error("params not set"),d.RcCode.RC_CODE_E_INVALIDARG,t;var e=e.list,E=[];this._loopStructureData(e,this._loopStructureData,E);var y=this.__reStrcutGroup,S=this,R=[],O=[],I=(I=function(d,p){p<d.length&&this.swGetPuGroupInfo({info:{groupid:d[p].szid},callback:function(e,t,n){d[p].szpu=[];var o,i,s,r=!0;for(s in n.ppuidList){o=n.ppuidList[s],i=S.swGetPu(o);try{r=!0,null==i?r=!1:f&&(r=f(i,o)),"boolean"==typeof r&&r?d[p].szpu.push(i):"object"==typeof r&&d[p].szpu.push(r),r&&R.push(o),C&&O.push(o)}catch(e){alert(e)}}if(++p<d.length&&I(d,p),p==d.length){var a,l,u,c=[],_=null;for(u in S._arr_pu)l=S._arr_pu[u],a=l._id_pu,0==(C?O:R).some(function(e){return e===a})&&(_=l,(_=C?(_=C(l,a))&&("object"==typeof _?_:l):_)&&c.push(l));E=y(E),f&&0==g&&(E=m(E)),h.callback({tag:h.tag},{emms:{code:0}},{result:E,pulist:c})}}})}).bind(this);return 0<E.length?I(E,0):h.callback({tag:h.tag},{emms:{code:0}},{result:[],pulist:S._arr_pu}),t},_impFilterNULLPuGroup:function(e,t){for(var n,o=null,i=0;i<t.length;i++)n=(o=t[i]).items,o.items=[],0<n.length&&this._impFilterNULLPuGroup(o.items,n),(0<o.items.length||0<o.szpu.length)&&e.push(o);return e.length},_loopFilterNULLPuGroup:function(e){var t=[];return this._impFilterNULLPuGroup(t,e),t},_loopStructureData:function(e,t,n){for(var o in e)n.push(e[o]),t(e[o].items,t,n)},swGetPuGroupInfo:function(e){var t=d.RcCode.RC_CODE_E_UNSUPPORTED;if(i.CheckOcx())return t;if(void 0===e)return console.error("params not set"),d.RcCode.RC_CODE_E_INVALIDARG,t;if(void 0===e.callback||"function"!=typeof e.callback)return console.error("callbak not set"),d.RcCode.RC_CODE_E_INVALIDARG,t;var n=new proto.BVCU.PUConfig.GroupInfo;return n.setSzid(e.info.groupid),t=p.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_GROUPINFO,callback:e.callback,payload:n,tag:e.tag})},swPuAddGroup:function(e){var t=d.RcCode.RC_CODE_E_UNSUPPORTED;if(i.CheckOcx())return t;if(void 0===e)return console.error("params not set"),d.RcCode.RC_CODE_E_INVALIDARG,t;if(void 0===e.callback||"function"!=typeof e.callback)return console.error("callbak not set"),d.RcCode.RC_CODE_E_INVALIDARG,t;var n=new proto.BVCU.PUConfig.GroupInfo;if(void 0!==e.info.name?n.setSzname(e.info.name):n.setSzname(""),void 0===e.info.groupid)return d.RcCode.RC_CODE_E_INVALIDARG;if(n.setSzid(e.info.groupid),void 0!==e.info.parentid){if(e.info.groupid==e.info.parentid)return console.error("璁惧缁勭埗ID涓嶈兘涓鸿嚜韬獻D"),d.RcCode.RC_CODE_E_INVALIDARG;n.setSzparentid(e.info.parentid)}if(void 0!==e.info.desc&&n.setSzdescription(e.info.desc),void 0!==e.info.szpu)for(var o=0;o<e.info.szpu.length;o++)n.addPpuid(e.info.szpu[o]);return t=p.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_PU_ADDGROUP,callback:e.callback,payload:n,tag:e.tag})},swPuModGroup:function(e){var t=d.RcCode.RC_CODE_E_UNSUPPORTED;if(i.CheckOcx())return t;if(void 0===e)return console.error("params not set"),d.RcCode.RC_CODE_E_INVALIDARG,t;if(void 0===e.callback||"function"!=typeof e.callback)return console.error("callbak not set"),d.RcCode.RC_CODE_E_INVALIDARG,t;if(void 0===e.info)return d.RcCode.RC_CODE_E_INVALIDARG,t;var n=new proto.BVCU.PUConfig.GroupInfo;if(void 0!==e.info.name?n.setSzname(e.info.name):n.setSzname(""),void 0===e.info.groupid)return d.RcCode.RC_CODE_E_INVALIDARG;if(n.setSzid(e.info.groupid),void 0!==e.info.parentid?n.setSzparentid(e.info.parentid):n.setSzparentid(""),void 0!==e.info.desc?n.setSzdescription(e.info.desc):n.setSzdescription(""),void 0!==e.info.szpu)for(var o=0;o<e.info.szpu.length;o++)n.addPpuid(e.info.szpu[o]);return t=p.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_PU_MODGROUP,callback:e.callback,payload:n,tag:e.tag})},swPuDelGroup:function(e){var t=d.RcCode.RC_CODE_E_UNSUPPORTED;if(i.CheckOcx())return t;if(void 0===e)return console.error("params not set"),d.RcCode.RC_CODE_E_INVALIDARG,t;if(void 0===e.callback||"function"!=typeof e.callback)return console.error("callbak not set"),d.RcCode.RC_CODE_E_INVALIDARG,t;var n=new proto.BVCU.PUConfig.GroupInfo;return n.setSzid(e.info.groupid),t=p.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_PU_DELGROUP,callback:e.callback,payload:n,tag:e.tag})},swDispose:function(){var e;this._arr_pu_online&&0<this._arr_pu_online.length&&(this._arr_pu_online.every(function(e,t,n){e._clear()}),this._arr_pu_online=[]),this._timer_keeplive&&(clearInterval(this._timer_keeplive),this._timer_keeplive=0),this._ws&&(this._ws.onclose=null,this._ws.close(),console.log("close ws")),!i.CheckNotOcx()||(e=d.DependencyMgr.GetModule("Audio"))&&e.DestroyWs(),d.SWVideoChanel._Ocx_PlayObjMgr.Free()},compare:function(e){return this._server==e._server&&this._port==e._port&&this._user==e._user},_internalOnResponseFail:function(e,t,n){var o=e.cmd;e.param;o==p.RequestHeader.pubkey.cmd&&p.RequestHeader.login.cmd},_internalOnResponseSuccess:function(t,n,o){d.DependencyMgr.HandleResponseInJect(function(e){e.internalOnResponseSuccess(this,t,n,o)},this)},_internalNotify:function(t,n){d.DependencyMgr.HandleResponseInJect(function(e){e.handleNotify(this,t,n)},this)},_internalOnResponsePulist:function(e){var t,n,o=[];return e&&"function"==typeof e.forEach&&(t=null,n=this,e.forEach(function(e){(t=n._arr_pu_index[e.szid])?(t._internalUpdate(e),n._swCheckPuArr(t)):(1==(t=new d.SWPu(n,e))._info_pu.onlinestatus?n._arr_pu_online.push(t):0==t._info_pu.onlinestatus&&n._arr_pu_offline.push(t),n._arr_pu.push(t),n._arr_pu_index[e.szid]=t),o.push(t)})),o},_internalOnResponseConfList:function(e){null!=this._confManager&&this._confManager._swFreshConflist&&this._confManager._swFreshConflist(e)},_internalOnConfResponse:function(e,t){switch(e){case proto.WEBBVCU.MSGType.WEB_BVCU_GET_CONF_LIST:null!=this._confManager&&this._confManager._swFreshConflist&&this._confManager._swFreshConflist(t);break;case proto.WEBBVCU.MSGType.WEB_BVCU_GET_CONF_INFO:return this._confManager._swFreshConfInfo(t);case proto.WEBBVCU.MSGType.WEB_BVCU_SET_CONF_CREATE:var n=this._confManager._swFreshConfInfo(t);return this._confManager._dispatchCallback(n,p.RequestHeader.confnotify.notifyconfcreate.cmd,n.swGetConfInfo().id),n;case proto.WEBBVCU.MSGType.WEB_BVCU_GET_USER_ONLINE:this._confManager._swFreshUserOnlielist(t);break;case proto.WEBBVCU.MSGType.WEB_BVCU_SET_CONF_DELETE:this._confManager._onConfDeletedOk(t);break;case proto.WEBBVCU.MSGType.WEB_BVCU_CONF_PARTICIPATOR_ADD:case proto.WEBBVCU.MSGType.WEB_BVCU_CONF_PARTICIPATOR_REMOVE:this._confManager._onParticularAddResult(t);break;case proto.WEBBVCU.MSGType.WEB_BVCU_CONF_START:case proto.WEBBVCU.MSGType.WEB_BVCU_CONF_STOP:this._confManager._onConfOpertaion(t);break;case proto.WEBBVCU.MSGType.WEB_BVCU_CONF_PARTICIPATOR_APPLYFOR_STARTSPEAK:case proto.WEBBVCU.MSGType.WEB_BVCU_CONF_PARTICIPATOR_APPLYFOR_ENDSPEAK:this._confManager._onApplyForSpeak(t);break;case proto.WEBBVCU.MSGType.WEB_BVCU_CONF_RETURN:case proto.WEBBVCU.MSGType.WEB_BVCU_CONF_LEAVE:this._confManager._onConfLeaveOrReturn(t)}}}},function(e,t,n){var n=n(0),f=n.jSW,r=n.jSWProtocol,o=n.jSWUtils;n.jSWOptions,n.PuLoad,n.AudioMgr,n.HTTPNruFile;f.SwUserManager=function(e){this._session=e,this._grouplist=[],this._ondatachangedcallback=null,this._initCallback=null,this._usertag=null,this._isInitOver=!1,this._currentUser=null,this._currentuserid=""},f.SwUserManager.SYSADMIN={NONE:0,GROUP:1,USER:4,DEV:16,DEVASS:64,ALL:85},f.SwUserManager.PERMISSIONS={OFF:0,ON:1},f.SwUserManager.DEFAULT={GROUP_GOD:"Admin",USER:"admin"},f.SwUserManager.Buffer=function(){this._Buffer_Strack=[]},f.SwUserManager.Buffer.prototype={_Buffer_Size:1024,_push:function(e){if(!this._is_id_exist(e.id)){for(;this._Buffer_Strack.length>this._Buffer_Size;)(e=this._Buffer_Strack.pop()).tag._clearinfo(e.tag);this._Buffer_Strack.unshift(e)}},_is_id_exist:function(e){for(itemIndex in this._Buffer_Strack)if(this._Buffer_Strack[itemIndex].id==e)return!0;return!1},_clear:function(){this._Buffer_Strack=[]}},f.SwUserManager.SwUser=function(e,t,n){this._session=e,this._user=t,this._group=n,this._userinfo=null},f.SwUserManager.SwUser.prototype={_static_buffer:new f.SwUserManager.Buffer,_clearinfo:function(e){e._userinfo=null},swGetUserInfo:function(e){return this._static_buffer._is_id_exist(this._user.id)?(setTimeout(e.callback,5,{tag:e.tag},{emms:{code:0}},this._userinfo),f.RcCode.RC_CODE_S_OK):this._innerGetUserInfo(e)},swGetGroup:function(){return this._group},swModUser:function(e){var t={info:{name:this._user.name,email:this._userinfo.email,phone:this._userinfo.phone,description:this._userinfo.description,groupid:this._group._group.id,sysadmin:{isGroup:this._userinfo.isGroup,isUser:this._userinfo.isUser,isDev:this._userinfo.isDev,isDevAss:this._userinfo.isDevAss},resources:this._userinfo.resources,iptz:this._userinfo.iptz},callback:null,tag:null};return(e=o.extend({},t,e||{})).info.sysadmin=o.extend({},t.info.sysadmin,e.info.sysadmin||{}),this._mod_user(e)},_mod_user:function(e){var t=new proto.BVCU.UserConfig.UserInfo,n=0;return n+=e.info.sysadmin.isGroup?f.SwUserManager.SYSADMIN.GROUP:f.SwUserManager.SYSADMIN.NONE,n+=e.info.sysadmin.isUser?f.SwUserManager.SYSADMIN.USER:f.SwUserManager.SYSADMIN.NONE,n+=e.info.sysadmin.isDev?f.SwUserManager.SYSADMIN.DEV:f.SwUserManager.SYSADMIN.NONE,n+=e.info.sysadmin.isDevAss?f.SwUserManager.SYSADMIN.DEVASS:f.SwUserManager.SYSADMIN.NONE,t.setSname(e.info.name),t.setSemail(e.info.email),t.setSphone(e.info.phone),t.setSdescription(e.info.description),t.setIsysadmin(n),t.setIptz(e.info.iptz),t.setSid(this._userinfo.id),t.setSallocateid(this._userinfo.allocateId),t.setSgroupid(e.info.groupid),r._LocalResource_2Pb(e.info.resources,t),r.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_USER_MODUSER,payload:t,callback:e.callback,tag:e.tag})},swModPwd:function(e){return e=o.extend({},{data:{password:"",newpassword:""},callback:null,tag:null},e||{}),this._mod_pwd(e)},_mod_pwd:function(e){var t=new proto.BVCU.UserConfig.ModPassword;return t.setSid(this._user.id),t.setSpassword(o.string2Uint8Array(e.data.password)),t.setSnewpassword(o.string2Uint8Array(e.data.newpassword)),r.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_USER_MODPASSWD,payload:t,callback:e.callback,tag:e.tag})},swDelUser:function(e){return this._del_user(e)},_del_user:function(e){var t=new proto.BVCU.UserConfig.User;return t.setSid(this._user.id),t.setSgroupid(this._user.groupid),r.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_USER_DELUSER,payload:t,callback:e.callback,tag:e.tag})},_fresh_user_info:function(e){this._userinfo={id:e.sId,passwd:e.sPasswd,bsetpasswd:e.bSetPasswd,sysadmin:{isGroup:e.sysadmin.isGroup,isUser:e.sysadmin.isUser,isDev:e.sysadmin.isDev,isDevAss:e.sysadmin.isDevAss},iptz:e.iPtz,serverid:e.sServerId,groupid:e.sGroupId,imaxsession:e.iMaxSession,allocateId:e.sAllocateId,name:e.sName,phone:e.sPhone,email:e.sEmail,description:e.sDescription,resources:e.Resource.concat()},this._user={id:e.sId,groupid:e.sGroupId,name:e.sName}},_getUserInfo:function(e){var t=new proto.BVCU.UserConfig.User;return t.setSid(e.userid),t.setSgroupid(e.groupid),r.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_USER_USERINFO,payload:t,callback:e.callback,tag:e.tag})},_innerGetUserInfo:function(e){return this._getUserInfo({userid:this._user.id,groupid:this._user.groupid,callback:this._innerOnGetUserInfo,tag:{user:this,option:e}})},_innerOnGetUserInfo:function(e,t,n){var o=e.tag,e=o.user,o=o.option;e._getGroupInfo({callback:e._innerhelpOnGetUserInfo,tag:{option:o,data:n,user:e}})},_innerhelpOnGetUserInfo:function(e,t,n){var o=e.tag,i=o.user,e=o.option,o=o.data;i._fresh_user_info(o),--f.SwUserManager._InitIUserHelp.iCount,f.SwUserManager._InitIUserHelp.iCount<=0&&i._session.swGetUserManager()._onInitOver(),null!=e.callback&&"function"==typeof e.callback&&e.callback({tag:e.tag},{emms:{code:0}},i._userinfo),i._static_buffer._push({id:i._userinfo.id,tag:i})},_getGroupInfo:function(e){this._group.swGetGroupInfo(e)}},f.SwUserManager._InitIUserHelp={iCount:0},f.SwUserManager.SwGroup=function(e,t,n){this._session=e,this._group=t,this._userlist=[],this.groupinfo=null,(this._groupinfo=null)!=n&&(this._groupinfo=n,this.groupinfo=n)},f.SwUserManager.SwGroup.prototype={_static_groupinfo_buffer:new f.SwUserManager.Buffer,_clearinfo:function(e){e._groupinfo=null,e.groupinfo=null},_getGroupInfo:function(e){var t=new proto.BVCU.UserConfig.UserGroup;return t.setSid(this._group.id),r.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_USER_GROUPINFO,payload:t,callback:this._onGetGroupInfo,tag:{group:this,option:e}})},_resolve:function(){this.groupinfo={id:this._group.id,name:this._groupinfo.name,parentid:this._groupinfo.parentid,description:this._groupinfo.description,resources:this._groupinfo.resources.concat(),allresources:[]},this.groupinfo.id!=f.SwUserManager.DEFAULT.GROUP_GOD&&(this.groupinfo.allresources=r._GetAllRescources(this._session,this.groupinfo.resources))},_onGetGroupInfo:function(e,t,n){var o=e.tag,e=o.group;e._groupinfo=n,e._resolve();o=o.option;null!=o.callback&&"function"==typeof o.callback&&o.callback({tag:o.tag},{emms:{code:0}},n),e._static_groupinfo_buffer._push({id:e._group.id,tag:e})},_groupSetFilter:function(){this.groupinfo.id=this._group.id,this.groupinfo.parentid=this._group.parentid},_mod_group:function(e){var t=new proto.BVCU.UserConfig.UserGroupInfo;return t.setSid(this._group.id),t.setSname(e.info.name),t.setSdescription(e.info.description),t.setSparentid(e.info.parentid),r._LocalResource_2Pb(e.info.resources,t),r.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_USER_MODGROUP,payload:t,callback:e.callback,tag:e.tag})},_del_group:function(e){var t=new proto.BVCU.UserConfig.UserGroup;return null==this._userlist?(console.warn("please get group info before delete it!"),f.RcCode.RC_CODE_E_FAIL):null!=this._userlist&&0<this._userlist.length?(console.warn("we can't delete the group because it contains more than 1 user!"),f.RcCode.RC_CODE_E_FAIL):(t.setSid(this._group.id),t.setSparentid(this._group.parentid),r.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_USER_DELGROUP,payload:t,callback:e.callback,tag:e.tag}))},_add_user:function(e){var t=new proto.BVCU.UserConfig.UserInfo,n=0;return n+=e.info.sysadmin.isGroup?f.SwUserManager.SYSADMIN.GROUP:f.SwUserManager.SYSADMIN.NONE,n+=e.info.sysadmin.isUser?f.SwUserManager.SYSADMIN.USER:f.SwUserManager.SYSADMIN.NONE,n+=e.info.sysadmin.isDev?f.SwUserManager.SYSADMIN.DEV:f.SwUserManager.SYSADMIN.NONE,n+=e.info.sysadmin.isDevAss?f.SwUserManager.SYSADMIN.DEVASS:f.SwUserManager.SYSADMIN.NONE,t.setSid(e.info.id),0<e.info.passwd.length&&e.info.passwd.length<64?t.setSpasswd(o.string2Uint8Array(e.info.passwd)):64<e.info.passwd.length&&console.log("the passwd you seted is out of range"),t.setSname(e.info.name),t.setSemail(e.info.email),t.setSphone(e.info.phone),t.setSdescription(e.info.description),t.setIsysadmin(n),t.setIptz(e.info.iptz),t.setSallocateid(e.info.allocateId),t.setSgroupid(this._group.id),r._LocalResource_2Pb(e.info.resources,t),r.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_USER_ADDUSER,payload:t,callback:e.callback,tag:e.tag})},_onGetUser:function(e){var t=null,n=!1;for(userIndex in this._userlist)if((t=this._userlist[userIndex])._user.id==e.id){t._user=e,n=!0;break}n||(t=this._local_add_user(e));this._session.swGetUserManager();return t},_local_add_user:function(e){e=new f.SwUserManager.SwUser(this._session,e,this);return this._userlist.push(e),e},_on_notify_mod_user:function(e){var t,n=null,o=!1;for(userindex in this._userlist)if((n=this._userlist[userindex])._user.id==e.sId){o=!0;break}return o?n._fresh_user_info(e):(t={id:e.sId,groupid:e.sGroupId,name:e.sName},(n=new f.SwUserManager.SwUser(this._session,t,this))._fresh_user_info(e),this._userlist.push(n)),n},_on_notify_del_user:function(e){var t=null;for(userindex in this._userlist)if((t=this._userlist[userindex])._user.id==e._user.id){this._userlist.splice(userindex,1);break}return t},swAddUser:function(e){var t={info:{id:"",passwd:"",name:"",email:"",phone:"",description:"",groupid:this._group.id,sysadmin:{isGroup:!1,isUser:!1,isDev:!1,isDevAss:!1},resources:[]},callback:null,tag:null};return(e=o.extend({},t,e||{})).info=o.extend({},t.info,e.info||{}),this._add_user(e)},swGetUserList:function(e){return setTimeout(e.callback,5,{tag:e.tag},{emms:{code:f.RcCode.RC_CODE_S_OK}},this._userlist),f.RcCode.RC_CODE_S_OK},swGetUserById:function(e){var t;for(userIndex in this._userlist)if((t=this._userlist[userIndex])._user.id==e)return t;return null},swGetGroupInfo:function(e){return this._static_groupinfo_buffer._is_id_exist(this._group.id)?(setTimeout(e.callback,5,{tag:e.tag},{emms:{code:0}},this.groupinfo),f.RcCode.RC_CODE_S_OK):this._getGroupInfo(e)},swModGroup:function(e){var t={info:{name:this._group.name,description:this._groupinfo.description,parentid:this._groupinfo.parentid,resources:this._groupinfo.resources},callback:null,tag:null};return(e=o.extend({},t,e||{})).info=o.extend({},t.info,e.info||{}),this._mod_group(e)},swDelGroup:function(e){return this._del_group(e)}},f.SwUserManager.prototype={_clear:function(){f.SwUserManager.SwUser.prototype._static_buffer._clear(),f.SwUserManager.SwGroup.prototype._static_groupinfo_buffer._clear(),f.SwUserManager.prototype._initCallback=null,f.SwUserManager.prototype._usertag=null,f.SwUserManager.prototype._isInitOver=!1,f.SwUserManager.prototype._currentUser=null,f.SwUserManager.prototype._currentuserid="",f.SwUserManager.prototype._grouplist=[]},_getUserGroupList:function(e){var t=r.JsonParamCommand(this._session._p_emms,proto.WEBBVCU.MSGType.WEB_BVCU_GET_USER_GROUPLIST,r.BVCU_Command("",-1,null));return r._internalSend({cmd:r.RequestHeader.usercfg.getgrouplist.cmd,session:this._session,request:t,callback:e.callback,tag:e.tag})},_getUserList:function(e){return r.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_USER_USERLIST,callback:e.callback,tag:e.tag})},_innerGetUserList:function(){this._getUserList({callback:this._onGetUserList,tag:this})},_onGetUserList:function(e,t,n){var o,i,s=e.tag,r=null;for(userindex in f.SwUserManager._InitIUserHelp.iCount=n.length,n)o=n[userindex],null!=(r=s._getGroupById(o.groupid))&&(i=r._onGetUser(o))._user.id==s._currentuserid&&(s._currentUser=i);s._onInitOver()},_getGroupById:function(e){var t;for(groupindex in this._grouplist)if((t=this._grouplist[groupindex])._group.id==e)return t;return null},_getOnlineUsers:function(e){return r.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_USER_ONLINE,callback:e.callback,tag:e.tag})},swGetUserInfo:function(e){return this._getOnlineUserInfo(e)},_getOnlineUserInfo:function(e){var t=new proto.BVCU.UserConfig.UserOnline;return e.devid&&t.setSzdevid(e.devid),e.userid&&t.setSuserid(e.userid),e.applierid&&t.setIapplierid(e.applierid),r.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_USER_ONLINEINFO,payload:t,callback:e.callback,tag:e.tag})},_add_group:function(e){var t=new proto.BVCU.UserConfig.UserGroupInfo;return t.setSid(e.info.id),t.setSname(e.info.name),t.setSdescription(e.info.description),t.setSparentid(e.info.parentid),r._LocalResource_2Pb(e.info.resources,t),r.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_USER_ADDGROUP,payload:t,callback:e.callback,tag:e.tag})},_kickout_user:function(e){var t=new proto.BVCU.UserConfig.Kickout;return r.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_USER_KICKOUT,payload:t,callback:e.callback,tag:e.tag})},_onInitOver:function(e){this._isInitOver&&!e||(this._isInitOver=!0,this._initCallback({tag:this._usertag},{emms:{code:0}},null))},_add_group_to_local:function(e,t){t=new f.SwUserManager.SwGroup(e,t);this._grouplist.push(t)},_on_notify_mod_group:function(e){var t=!1,n=null;for(o in this._grouplist)if((n=this._grouplist[o])._group.id==e.id){t=!0;break}if(t)for(var o in n._groupinfo=e,n.groupinfo=e,n._group)n._group[o]=n.groupinfo[o];else{var i={id:e.id,name:e.name,parentid:e.parentid},n=new f.SwUserManager.SwGroup(this._session,i,e);this._grouplist.push(n)}return n},_on_notify_del_group:function(e){var t=null,n=!1;for(groupindex in this._grouplist)if((t=this._grouplist[groupindex])._group.id==e.id){this._grouplist.splice(groupindex,1),n=!0;break}return n?t:null},_on_notify_mod_user:function(e){var t=null,n=null;for(groupIndex in this._grouplist)if((t=this._grouplist[groupIndex])._group.id==e.sGroupId){n=t._on_notify_mod_user(e);break}var o=null;for(groupIndex in this._grouplist)(o=(t=this._grouplist[groupIndex]).swGetUserById(e.sId))&&o._user.groupid!=e.sGroupId&&o._group._on_notify_del_user(n);return n},_on_notify_del_user:function(e){var t=null;return t=null!=(t=this._getUserById(e.id))?t._group._on_notify_del_user(t):t},onGetGroupList:function(e,t,n){var o,i=e.tag.userManager,s=null,r=!1;for(groupindex in n){for(localgroupindex in o=n[groupindex],i._grouplist)if(s=i._grouplist[localgroupindex],o.id==s._group.id){s._group=o,r=!0;break}r||i._add_group_to_local(this.session,o),r=!1}i._innerGetUserList()},_onNotify:function(e,t,n){if(this._isInitOver){var o=null,i="",s=null;switch(e){case proto.WEBBVCU.MSGType.WEB_BVCU_NOTIFY_USER_ADDGROUP:o=proto.BVCU.UserConfig.UserGroupInfo.deserializeBinary(n),o=r.GroupInfoPb_2Json(o,this._session),s=this._on_notify_mod_group(o),i=r.RequestHeader.usercfg.addgroup.cmd;break;case proto.WEBBVCU.MSGType.WEB_BVCU_NOTIFY_USER_MODGROUP:o=proto.BVCU.UserConfig.UserGroupInfo.deserializeBinary(n),o=r.GroupInfoPb_2Json(o,this._session),s=this._on_notify_mod_group(o),i=r.RequestHeader.usercfg.modgroupinfo.cmd;break;case proto.WEBBVCU.MSGType.WEB_BVCU_NOTIFY_USER_DELGROUP:o=proto.BVCU.UserConfig.UserGroup.deserializeBinary(n),o=r.GroupPb_2Json(o),s=this._on_notify_del_group(o),i=r.RequestHeader.usercfg.delgroup.cmd;break;case proto.WEBBVCU.MSGType.WEB_BVCU_NOTIFY_USER_ADDUSER:o=proto.BVCU.UserConfig.UserInfo.deserializeBinary(n),o=r.USER_USERINFO_Pb2Json(o,this._session),s=this._on_notify_mod_user(o),i=r.RequestHeader.usercfg.adduser.cmd;break;case proto.WEBBVCU.MSGType.WEB_BVCU_NOTIFY_USER_MODUSER:o=proto.BVCU.UserConfig.UserInfo.deserializeBinary(n),o=r.USER_USERINFO_Pb2Json(o,this._session),s=this._on_notify_mod_user(o),i=r.RequestHeader.usercfg.moduserinfo.cmd;break;case proto.WEBBVCU.MSGType.WEB_BVCU_NOTIFY_USER_DELUSER:o=proto.BVCU.UserConfig.User.deserializeBinary(n),o=r.USER_USERPb_2Json(o),s=this._on_notify_del_user(o),i=r.RequestHeader.usercfg.deluser.cmd}""!=i&&this._ondatachangedcallback(this,{},{cmd:i,target:s})}},swGetCurrentUser:function(){return this._isInitOver?this._currentUser:(console.log("please call get info function after init over!!!!!"),null)},swGetUAInfoByPuid:function(e){return"string"!=typeof e.targetId||0==e.targetId.length?f.RcCode.RC_CODE_E_FAIL:(e.devidorname=e.targetId,e.useridorname=null,this._SearchUAList(e))},swGetUAInfoByUserName:function(e){return"string"!=typeof e.targetId||0==e.targetId.length?f.RcCode.RC_CODE_E_FAIL:(e.devidorname=null,e.useridorname=e.targetId,this._SearchUAList(e))},_SearchUAList:function(n){return o.CheckOptionsCallback(n,function(){var e=new proto.BVCU.Search.Search_Request,t=new proto.BVCU.Search.SearchInfo;e.setStsearchinfo(t),t.setItype(r.SearchType.UALIST),t.setIcount(Number(100)),t.setIpostition(Number(0));t=new proto.BVCU.Search.Search_UAListFilter;return e.setStualistfilter(t),null!=n.devidorname&&t.setSzdevidorname(n.devidorname),null!=n.useridorname&&t.setSzuseridorname(n.useridorname),r.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SEARCH_UALIST,payload:e,callback:n.callback,tag:n.tag})},this)},swInit:function(e){if(null!=e&&null!=e.ondatachanged&&null!=e.callback)return this._ondatachangedcallback=e.ondatachanged,this._initCallback=e.callback,this._isInitOver?(this._onInitOver(!0),f.RcCode.RC_CODE_S_OK):(this._currentuserid=this._session._user,this._isInitOver=!1,this._usertag=e.tag,this._getUserGroupList({callback:this.onGetGroupList,tag:{userManager:this,isInit:!0}}));console.log("options must be fill correctly! please try again")},swGetCurrentUserId:function(){return this._currentuserid},swGetGroupList:function(e){return this._isInitOver?(setTimeout(e.callback,5,{tag:e.tag},{emms:{code:f.RcCode.RC_CODE_S_OK}},this._grouplist),f.RcCode.RC_CODE_S_OK):(console.log("please call get info function after init over!!!!!"),null)},swFormatGroupList:function(e){if("function"!=typeof e.callback)return f.RcCode.RC_CODE_E_INVALIDARG;var t,n,o,i=e.filterCallback,s=[],r=[],a=null,l=null,u=[],c=null;for(o in this._grouplist){for(var l={info:(a=this._grouplist[o])._group,type:"1",children:[]},_=0;_<a._userlist.length;_++)c={info:{allocateId:(n=a._userlist[_])._user.allocateId,name:n._user.name,id:n._user.id,groupid:n._user.groupid,description:n._user.description,email:n._user.email,sysadmin:n._user.sysadmin},user:n,type:"2",bReplace:!1},i&&((t=i(c.info))?"object"==typeof t&&(c.info=t,c.bReplace=!0):c=null),c&&l.children.push(c);(""==a._group.parentid?s:r).push(l),u.push({target:l,group:a})}var d=this._FilterUserGroupNULLUser.bind(this),p=this._BuildStructureData;p(s,r,p);let h=function(e,t,i,s,r){var n,o;0==e&&(r={iCount:0}),0!=s?e>=t.length||("2"==t[e].type&&(n=t[e].user,o=t[e].bReplace,t[e]={info:t[e].info,type:t[e].type},n.swGetUserInfo({callback:function(e,t,n){var o=e.tag.user;0==e.tag.bReplace&&(o.info={allocateId:n.allocateId,name:n.name,id:n.id,groupid:n.groupid,description:n.description,email:n.email,sysadmin:n.sysadmin}),r.iCount++,r.iCount==s&&i()},tag:{user:t[e],bReplace:o}})),h(e+1,t,i,s,r)):i()},g=function(e,i,s){var r=null;e<i.length?(r=i[e]).group.swGetGroupInfo({callback:function(e,t,n){var o;0==t.emms.code?(r=r.target,e=e.tag,r.info={description:n.description,id:n.id,parentid:n.parentid,name:n.name},r.info.isAmdin="Admin"==n.id,o=e+1,e=r.children.filter(function(e){return"2"==e.type}).length,h(0,r.children,function(){g(o,i,s)},e)):s(t.emms.code)},tag:e}):s(0)};return g(0,u,function(){i&&(s=d(s)),setTimeout(e.callback,5,{tag:e.tag},{emms:{code:f.RcCode.RC_CODE_S_OK}},s)}),f.RcCode.RC_CODE_S_OK},_ImpFilterUserGroupNULLUser:function(e,t){for(var n,o,i=null,s=0;s<t.length;s++)o=(i=t[s]).children.filter(function(e){return"1"==e.type}),n=i.children.filter(function(e){return"2"==e.type}),i.children=n,0<o.length&&this._ImpFilterUserGroupNULLUser(i.children,o),0<i.children.length&&e.push(i);return 0<e.length},_FilterUserGroupNULLUser:function(e){var t=[];return this._ImpFilterUserGroupNULLUser(t,e),t},_BuildStructureData:function(e,t,n){for(var o in e){tempGroup=e[o];var i,s=[];for(i in t)tempGroupLite=t[i],tempGroupLite&&tempGroupLite.info.parentid==tempGroup.info.id&&(t[i]=null,tempGroup.children.push(tempGroupLite),s.push(tempGroupLite));n(s,t,n)}},swGetGroupById:function(e){return this._getGroupById(e)},swGetUserById:function(e,t){e=this.swGetGroupById(e);return null==e?null:e.swGetUserById(t)},_getUserById:function(e){var t=null;for(groupindex in this._grouplist)if(group=this._grouplist[groupindex],null!=group&&null!=(t=group.swGetUserById(e)))break;return t},swAddGroup:function(e){e=o.extend({},{info:{name:"",description:"",parentid:"",resources:[]},callback:null,tag:null},e||{});return this._add_group(e)}}},function(e,t,n){var n=n(0),a=n.jSW,l=n.jSWProtocol,u=n.jSWUtils,i=n.jSWOptions,r=(n.PuLoad,n.AudioMgr,n.HTTPNruFile);a.SWPu=function(e,t){this._parent=e,this._innerCommUpdata(t),u.debugLogInfo(this._info_pu.id+"v:"+this._arr_channel.length+",g"+this._arr_gps.length)},a.SWPu.SATELLITE={GPS:1,BDS:2,GLONASS:4,GALILEO:8,QZSS:16},a.SWPu.prototype={swReboot:function(){return a.RcCode.RC_CODE_E_UNSUPPORTED},swSetPuManualrecord:function(e){var t=new proto.BVCU.PUConfig.ManualRecord;return e=u.extend({},{isstart:1,ilength:-1,szFileName:"",iChannel:0,iFileType:9,callback:null},e||{}),t.setBstart(e.isstart),t.setIlength(l.Int2Uint(e.ilength)),t.setSzfilename(e.szFileName),t.setIchannelindex(e.iChannel),t.setIfiletype(e.iFileType),l.SendRequest({session:this._parent,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_PU_MANUALRECORD,target:this._id_pu,payload:t,callback:e.callback,tag:e.tag})},swGetPuRecordStatus:function(e){return l.SendRequest({session:this._parent,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_RECORDSTATUS,target:this._id_pu,callback:e.callback,tag:e.tag})},swPuControl:function(e){var t=l.CheckOptions(proto.WEBBVCU.MSGType.WEB_BVCU_SET_PU_REBOOT_OR_SHUTDOWN,e);return t!=a.RcCode.RC_CODE_S_OK?t:((new proto.WEBBVCU.PU_CONTROL).setIoption(e.ioption),t=l.SendRequest({session:this._parent,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_PU_REBOOT_OR_SHUTDOWN,target:this._id_pu,callback:e.callback,tag:e.tag}))},swSetPuSnapshot:function(e){var t=new proto.BVCU.PUConfig.Snapshot;return e=u.extend({},{istart:0,icyclecount:0,szftpid:null,callback:null,tag:null},e||{}),t.setBstart(e.istart),t.setIcyclecount(e.icyclecount),t.setSzftpid(e.szftpid),l.SendRequest({session:this._parent,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_PU_SNAPSHOT,target:this._id_pu,payload:t,callback:e.callback,tag:e.tag})},swGetChanel:function(e){for(var t=0;t<this._arr_channel.length;t++)if(this._arr_channel[t]._id_chanel==e)return this._arr_channel[t];for(t=0;t<this._arr_gps.length;t++)if(this._arr_gps[t]._id_chanel==e)return this._arr_gps[t];for(t=0;t<this._arr_tsp.length;t++)if(this._arr_tsp[t]._id_chanel==e)return this._arr_tsp[t];return null},swUploadFirmware:function(s){s=u.extend({},{pcallback:null},s||{});var e,t=a.RcCode.RC_CODE_E_INVALIDARG,n=s.file,o=s.remotepath;return i.calltype==a.CallProtoType.OCX?n&&(0==n.indexOf("C:\\fakepath\\")?console.error("file path error"):((e=new proto.WEBBVCU.DownFileFromPu).setSzlocalfilepathname(n),o&&e.setSzremotefilepathname(o),t=l.SendRequest({payload:e,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_UPLOAD_FILE_TONRU,session:this._parent,target:this._id_pu,callback:s.callback,callbackrelay:s.pcallback,tag:s.tag}))):t=r.UploadToRoot(n,function(){},function(e,t,n,o,i){0==n.indexOf("/")&&(n=n.slice(1)),s.pcallback&&s.pcallback({tag:s.tag},{emms:{code:e}},{sEvent:{iEvent:a.FileTransEvent.FILE_TRANS_CLOSE,iResult:e,szRemoteFilePath:n,szLocalFilePath:n,nruid:t},sProgressInfo:null}),s.callback&&s.callback({tag:s.tag},{emms:{code:e}})}),t},swUpgradeFirmware:function(e){a.RcCode.RC_CODE_E_FAIL;e=u.extend({},{szNruId:"",szFilePath:"",szFileName:"",bPromptly:!0,callback:null,tag:null},e||{});var t=new proto.BVCU.PUConfig.Upgrade;return t.setSzftpid(e.szNruId),t.setSzfilepath(e.szFilePath),t.setSzfilename(e.szFileName),t.setBpromptly(e.bPromptly?1:0),l.SendRequest({session:this._parent,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_PU_UPGRADE,target:this._id_pu,payload:t,callback:e.callback,tag:e.tag})},swGetUpdateStatus:function(e){return l.SendRequest({target:this._id_pu,session:this._parent,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_UPDATESTATUS,callback:e.callback,tag:e.tag})},_getGPSChannelById:function(e){for(var t in this._arr_gps)if(this._arr_gps[t]._id_chanel==e)return this._arr_gps[t];return null},_getTSPChannelById:function(e){for(var t in this._arr_tsp)if(this._arr_tsp[t]._id_chanel==e)return this._arr_tsp[t];return null},_getVideoChannelById:function(e){for(var t in this._arr_channel)if(this._arr_channel[t]._id_chanel==e)return this._arr_channel[t];return null},_innerCommUpdata:function(e){var t=e.pchannelList;this._info_pu={bootduration:e.ibootduration,boottime:l.Walltime2Json(e.stboottime),chanelcount:t.length,chanellist:[],id:e.szid,lat:e.ilatitude,long:e.ilongitude,name:e.szpuname,onlinestatus:e.ionlinestatus,onlinethrough:e.ionlinethrough,onlinetime:l.Walltime2Json(e.stonlinetime)},this._id_pu=this._info_pu.id,this._name_pu=this._info_pu.name,this._arr_tsp=[],void 0===this._arr_gps&&(this._arr_gps=[]),void 0===this._arr_channel&&(this._arr_channel=[]);for(var n=null,o=0;o<t.length;o++){var i,s,r=l.ChanelType.getType(t[o].ichannelindex),n=null;r==l.ChanelType.chanel?(i=this._getVideoChannelById(t[o].ichannelindex))?i._updateInfo(t[o]):(i=new a.SWVideoChanel(this,t[o]),this._arr_channel.push(i),n=i):r==l.ChanelType.gps?null==(i=this._getGPSChannelById(t[o].ichannelindex))?(i=new a.SWGPSChanel(this,t[o]),this._arr_gps.push(i),n=i):i._updateInfo(t[o]):r==l.ChanelType.tsp&&(this._getTSPChannelById(t[o].ichannelindex)?s._updateInfo(t[o]):(s=new a.SWTSPChanel(this,t[o]),this._arr_tsp.push(s),n=s)),n&&this._info_pu.chanellist.push(n)}u.debugLogInfo(this._info_pu.id+"v:"+this._arr_channel.length+",g"+this._arr_gps.length)},_internalUpdate:function(e){0==e.ionlinestatus&&this._clear(),this._innerCommUpdata(e)},compare:function(e){return!!this._parent.compare(e._parent)&&this._id_pu==e._id_pu},_clear:function(){for(var e=0;e<this._arr_channel.length;e++)this._arr_channel[e]._clear();for(e=0;e<this._arr_gps.length;e++)0==this._arr_gps[e]._info_chanel.status&&this._arr_gps[e].swClose();for(e=0;e<this._arr_tsp.length;e++)0==this._arr_tsp[e]._info_chanel.status&&this._arr_tsp[e].swClose()}}},function(e,t,n){var n=n(0),y=n.jSW,S=n.jSWProtocol,h=n.jSWUtils,R=n.jSWOptions;n.PuLoad,n.AudioMgr,n.HTTPNruFile;y.SWVideoChanel=function(e,t){this._parent=e,this._updateInfo(t),this._url_channel=null,this.m_live_hls=null,this.m_live_rtmp=null,this._session=this._parent._parent,this._commDlgMgr=new y.CommonDlgMgr(this._session),this.ismuti=!1,this._open_status=y.SWVideoChanel._OpenStatus.NOT_OPEND,this._intercom=new y.SWVideoChanel.InterCom(this),this.m_prototype=4},y.SWVideoChanel._OpenStatus={NOT_OPEND:0,OPENING:1,OPENED:2},y.SWVideoChanel._OcxFullScreen={_lastVideoChanel:null,_hDlg:-1,beforeFullScreen:function(e,t){this._lastVideoChanel=e,this._hDlg=t},onClickEsc:function(){R.CheckOcx()&&document.msFullscreenElement&&document.msExitFullscreen()},upDateDialog:function(){this._lastVideoChanel&&this._lastVideoChanel._updateDialog(this._hDlg),document.msFullscreenElement||(this._lastVideoChanel=null)},onFullScreenChange:function(){setTimeout(y.SWVideoChanel._OcxFullScreen.upDateDialog.bind(y.SWVideoChanel._OcxFullScreen),200)}},y.SWVideoChanel._Ocx_PlayObjMgr={GetPlayObj:function(e){var t=this.TryGetAnPlayObj(e);return null==t&&((t=this.CreatePlayObj(e)).used=!0),t},FreePlayObj:function(e){e&&e.used&&(e.used=!1)},_szTargetPlayObj:[],CreatePlayObj:function(e){var t=document.createElement("object");return t.classid=e?"clsid:0c85b239-904a-4adf-8424-f1928b38f12f":"clsid:CDE6C639-4BA8-4A09-81EB-DCE76A61FE98",t.style.width="100%",t.style.height="100%",t.style.display="block",this._szTargetPlayObj.push(t),t.used=!1,t.bWindowless=e,t},CheckPlayObjFit:function(e,t){return 0==e.used&&e.bWindowless==t},TryGetAnPlayObj:function(e){for(var t=null,n=0;n<this._szTargetPlayObj.length;n++)if(this.CheckPlayObjFit(this._szTargetPlayObj[n],e)){(t=this._szTargetPlayObj[n]).used=!0;break}return t},Free:function(){this._szTargetPlayObj=[]}},document.addEventListener("keydown",function(){27==(window.event||arguments[0]).keyCode&&y.SWVideoChanel._OcxFullScreen.onClickEsc()}),y.SWVideoChanel.prototype={_updateInfo:function(e){this._info_chanel={id:e.ichannelindex,name:e.szname,ptz:e.iptz,media:e.imediadir,status:0},this._id_chanel=this._info_chanel.id,this._name_chanle=this._info_chanel.name,this._meida_chanel=this._info_chanel.media,this._ptz_chanel=this._info_chanel.ptz},swSetControlParam:function(e){var t=y.RcCode.RC_CODE_E_UNSUPPORTED;if(R.CheckOcx()){if(null==typeof e.Idelayvssmooth)return y.RcCode.RC_CODE_E_INVALIDARG;var n=new proto.WEBBVCU.ParamsDialogControl;return n.setIdelayvssmooth(e.Idelayvssmooth),t=this._autoDlgSendProxy(e,function(e){return{msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_DIALOG_PARAM,payload:n}})}return t},swSrcType:function(e){var s="unknown";return this._autoDlgProxy(e,function(e,t,n,o,i){e._prototype==S.ProtoType.HLS?s="hls":e._prototype==S.ProtoType.OCX?s="ocx":e._prototype==S.ProtoType.RTMP&&(s="rtmp")}),s},localRecords:[],_notifyDialogEventStorage:function(e,t){var n=null,o=!1;for(iIndex in this.localRecords)if((n=this.localRecords[iIndex]).szfilename==t.szfilename){o=!0;break}switch(o||(n={iresult:y.RcCode.RC_CODE_S_OK,szfilename:t.szfilename,itimestampbegin:0,itimestampend:0},this.localRecords.push(n)),e){case proto.WEBBVCU.MSGType.WEB_NOTIFY_BVCU_EVENT_STORAGE_FILE_OPEN:n.itimestampbegin=t.itimestamp,n.iresult=t.iresult;break;case proto.WEBBVCU.MSGType.WEB_NOTIFY_BVCU_EVENT_STORAGE_FILE_CLOSE:n.itimestampend=t.itimestamp,n.iresult=t.iresult;break;case proto.WEBBVCU.MSGType.WEB_NOTIFY_BVCU_EVENT_STORAGE_ERROR:n.iresult=t.iresult}e!=proto.WEBBVCU.MSGType.WEB_NOTIFY_BVCU_EVENT_STORAGE_FILE_CLOSE&&e!=proto.WEBBVCU.MSGType.WEB_NOTIFY_BVCU_EVENT_STORAGE_ERROR||null!=this._callbackAfterRecordHasResult&&this._callbackAfterRecordHasResult({channel:this,storage:n})},_callbackAfterRecordHasResult:null,_videoPlayer:null,_iVideoPlayerRotate:0,_OnNeedSaveVideoPlayer:function(e){this._videoPlayer=e,this._iVideoPlayerRotate=0},swFullScreen:function(e){return this._autoDlgProxy(e,function(e,t,n,o,i){var s;return R.CheckOcx()?(s=e.getPlayDiv().bv_uuid+"_0077554tempdiv",s=document.getElementById(s),document.onmsfullscreenchange||(document.onmsfullscreenchange=y.SWVideoChanel._OcxFullScreen.onFullScreenChange),document.msFullscreenElement?document.msExitFullscreen():(y.SWVideoChanel._OcxFullScreen.beforeFullScreen(this,i),s.msRequestFullscreen())):R.calltype==y.CallProtoType.HTTP&&(document.fullscreenElement?document.exitFullscreen():(s=e.getPlayDiv())&&s.requestFullscreen()),y.RcCode.RC_CODE_S_OK})},swGetStatisticsInfo:function(e){y.RcCode.RC_CODE_E_UNSUPPORTED;return R.CheckNotOcx(),this._autoDlgSendProxy(e,function(e){return{msgtype:proto.WEBBVCU.MSGType.WEB_GET_DIALOG_INFO}})},swGetDialogInfo:function(e){var t=new proto.BVCU.CMSConfig.CMSCFG_DialogInfo,n=new proto.BVCU.CMSConfig.CMSCFG_ChannelInfo;n.setSzid(this._parent._id_pu),t.setSttarget(n),t.setIchannelindex(this._id_chanel);S.SendRequest({session:this._parent._parent,payload:t,msgtype:proto.WEBBVCU.MSGType.WEB_GET_CMS_DIALOGINFO,callback:e.callback,tag:e.tag});return y.RcCode.RC_CODE_S_OK},swVideoRotate:function(u){return this._autoDlgProxy(u,function(e,t,n,o,i){var s=e.getRotate();if(s+=u.irotate,R.CheckOcx())return this._swOnDivSizeChange(s,i,u);if(R.CheckHttp()){if((s=u.irotate)%90!=0)return console.error(n," ",o,"rotate degree is not multiple of 90"),y.RcCode.RC_CODE_E_FAIL;if(null==this._videoPlayer)return console.error(n+" "+o+" video rotate faild, due not playing"),y.RcCode.RC_CODE_E_FAIL;if(null==this._videoPlayer._mediaElement.parentNode)return console.error(n+" "+o+" video rotate faild, parent node not exist"),y.RcCode.RC_CODE_E_FAIL;var r=this._videoPlayer._mediaElement.style,a=this._videoPlayer._mediaElement.parentNode,l=s%360/90,i=a.clientHeight/a.clientWidth,n=this._videoPlayer._mediaElement.videoHeight/this._videoPlayer._mediaElement.videoWidth,o=1/i,a=1/n;return e._rotate=s,0==l?(r.objectFit="contain",r.transform="none"):1==l||3==l?(r.objectFit="fill",s=e=1,(s=e=i)<a?s*=n/i:e*=a/o,r.transform=1==l?"rotate(90deg) scaleY("+s+") scaleX("+e+")":"rotate(270deg) scaleY("+s+") scaleX("+e+")"):2==l&&(r.objectFit="contain",r.transform="rotate(180deg)"),setTimeout(u.callback,50,{tag:u.tag},{emms:{code:y.RcCode.RC_CODE_S_OK}}),y.RcCode.RC_CODE_S_OK}})},swVideoStretch:function(n){var e=y.RcCode.RC_CODE_S_OK;return R.CheckNotOcx()?(e=this._autoDlgProxy(n,function(e){return e._mdiv&&0<e._mdiv.getElementsByTagName("video").length?(n.bStretch?$(e._mdiv.getElementsByTagName("video")[0]).css("object-fit","fill"):$(e._mdiv.getElementsByTagName("video")[0]).css("object-fit","contain"),y.RcCode.RC_CODE_S_OK):(h.debugLogInfo("present div not found, stretch video fail"),y.RcCode.RC_CODE_E_NOTFOUND)}),n.callback&&setTimeout(n.callback,50,{tag:n.tag},{emms:{code:e}})):e=this._autoDlgSendProxy(n,function(e){var t=new proto.WEBBVCU.CommonData;return t.setIdata1(n.bStretch?1:0),{msgtype:proto.WEBBVCU.MSGType.WEB_VIDEO_DIALOG_STRETCH,payload:t}}),e},swLocalSnapshot:function(o){if(R.CheckHttp()){y.RC_CODE_E_UNSUPPORTED;return this._autoDlgProxy(o,function(e){var t,n=null;return!e._mdiv||1==(t=e._mdiv.getElementsByTagName("video")).length&&(n=h.Snapshot(t[0],t[0].videoWidth,t[0].videoHeight)),o.callback&&(t=n?y.RcCode.RC_CODE_S_OK:y.RcCode.RC_CODE_E_FAIL,setTimeout(o.callback,50,{tag:o.tag},{emms:{code:t}},n)),y.RcCode.RC_CODE_S_OK})}return o.szFileName&&0!=o.szFileName.length?this._autoDlgSendProxy(o,function(e){var t=new proto.WEBBVCU.CommonData;return t.setIdata1(o.iQuality||100),t.setSzdata(h.string2Uint8Array(o.szFileName)),{msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_LOCAL_SNAPSHOT,payload:t}}):(console.log("swLocalSnapshot SzFilePath Is Invalid"),y.RcCode.RC_CODE_E_INVALIDARG)},_updateDialog:function(e){var t=y.RcCode.RC_CODE_E_UNSUPPORTED;return R.CheckOcx()?this._commSendProxy(options,function(){return{msgtype:proto.WEBBVCU.MSGType.WEB_VIDEO_DIALOG_UPDATE,hdlg:e}}):t},_swOnDivSizeChange:function(e,t,n){var o=new proto.WEBBVCU.VideoDialogRotate;o.setSzpuid(h.string2Uint8Array(this._parent._id_pu)),o.setIchannelindex(this._id_chanel),o.setIrotate(e);S.SendRequest({session:this._parent._parent,payload:o,msgtype:proto.WEBBVCU.MSGType.WEB_VIDEO_DIALOG_ROTATE,hdlg:t,callback:n.callback,tag:n.tag});return y.RcCode.RC_CODE_S_OK},_onOcxChanelChange:function(e,t,n){y.CallProtoType.OCX,R.calltype},_pushCommDlg:function(e,t){this._commDlgMgr.push(e,t)},ismutidhlg:0,_buildHdlg:function(e,t){return e},_beginOpen:function(){this.ismuti||(this._open_status=y.SWVideoChanel._OpenStatus.OPENING)},_endOpenHasResult:function(e){this.ismuti||(this._open_status=e?y.SWVideoChanel._OpenStatus.OPENED:y.SWVideoChanel._OpenStatus.NOT_OPEND)},_closeHasResult:function(e){this.ismuti||e&&(this._open_status=y.SWVideoChanel._OpenStatus.NOT_OPEND)},_checkCanOpen:function(e){return this.ismuti=e,!!this.ismuti||this._open_status==y.SWVideoChanel._OpenStatus.NOT_OPEND},_fillOpenParam:function(e){this.ismuti=e},_autoDlgProxy:function(e,o,i){var s=this._getOptsHdlg(e);if(this.ismuti&&(void 0===s||-1==s))return console.log("can't find the dialog from you hdlg"),y.RcCode.RC_CODE_E_INVALIDARG;var r=this.ismuti?this._commDlgMgr.get(s):this._commDlgMgr.getDefault();if(null==r)return console.log("can't find the dialog from you hdlg, maybe it's been closed"),y.RcCode.RC_CODE_E_NOTFOUND;s=r.getHDlg();return this._commProxy(function(e,t,n){return o.bind(this)(r,e,t,n,s,i)})},_getOptsHdlg:function(e){return e&&void 0!==e.hdlg?e.hdlg:-1},_getDesDiv:function(e){return"string"==typeof e?document.getElementById(e):e},_commProxy:function(e){return null==this._parent||null==this._parent._parent?(console.error("internal error, this._parent is null"),y.RcCode.RC_CODE_E_FAIL):e.bind(this)(this._parent._parent,this._parent._id_pu,this._id_chanel)},_commSendProxy:function(s,r){return this._commProxy(function(e,t,n){var o={payload:null,msgtype:-1,cmd:"",hdlg:-1,callback:s?s.callback:null,tag:s?s.tag:null},i=r.bind(this)(),i=h.extend({},o,i||{});return S.SendRequest({session:e,target:t,targetIndex:n,msgtype:i.msgtype,callback:i.callback,payload:i.payload,hdlg:i.hdlg,tag:i.tag,cmd:i.cmd})})},_autoDlgSendProxy:function(a,l,u){return this._autoDlgProxy(a,function(e,t,n,o,i){var s={payload:null,msgtype:-1,cmd:"",hdlg:-1,callback:null,tag:null,bcancel:!1};null==e&&null==a.hdlg&&(e=s.hdlg);var r=l.bind(this)(e),r=h.extend({},s,r||{}),s=y.RcCode.RC_CODE_S_OK;return 0==r.bcancel&&(s=S.SendRequest({session:t,target:n,targetIndex:o,msgtype:r.msgtype,callback:a.callback,payload:r.payload,hdlg:i,tag:a.tag,cmd:r.cmd})),u&&u.bind(this)(e),s})},swOpen:function(p){return this._commProxy(function(e,t,n){var o={callback:null,tag:null,prototype:"auto",media:y.MEDIADIR.VIDEORECV};p=h.extend({},o,p||{}),2==this._meida_chanel&&2!=p.media&&(p.media=2);var i=this._eventHandle.getProtoType(p.prototype,p.useoptions.bHttpFlv);if(y.RcCode.bFaild(i.rc))return i.rc;var s=i.prototype,r=p.tag.div,a=null,l=!1,u=p.useoptions.bwindowless,o=p.useoptions.bHttpFlv;2==s&&i.bHttpFlv&&(o=i.bHttpFlv,p.useoptions.bHttpFlv=i.bHttpFlv),null==r?console.warn("no have div ,we will not display the video stream, just throw stream url"):(c=this._eventHandle.beforeOpenPreparePlayDiv(s,r,u,o),a=c.playObj,l=c.isNeedDelay);var c=!!p.useoptions.bovertcp,_=this._eventHandle.sendOpenChanel,d=S.BVCU_DialogParam(t,n,0,s,p.media,0,0,c);return p.useoptions.bstretch&&d.setBstretch(!0),u&&d.setBwindowless(!0),d.setUsews(!!p.useoptions.usews),l?(setTimeout(function(){_(e,p,a,d)},500),y.RcCode.RC_CODE_S_OK):_(e,p,a,d)})},swOpenEx:function(e){var t={callback:null,div:"",prototype:"auto",media:y.MEDIADIR.VIDEORECV,bovertcp:!1,tag:null,ismuti:!1,bstretch:!1,bwindowless:!1,bHttpFlv:!1,usews:!1},t=h.extend({},t,e||{});if(R.CheckHttp()&&"auto"==t.prototype&&(t.prototype="httpflv"),"httpflv"==t.prototype&&(t.prototype="rtmp",t.bHttpFlv=!0,t.usews=!0),!this._eventHandle.checkMedia(t.media))return y.RcCode.RC_CODE_E_INVALIDARG;if(!this._checkCanOpen(t.ismuti)){e.ismuti||console.log("current open chanel model is mutil open!");e=y.RcCode.RC_CODE_E_ALREADYEXIST;return console.log(y.RcCode.trans(e)),y.RcCode.RC_CODE_E_ALREADYEXIST}this._beginOpen(),t.div=this._getDesDiv(t.div),null==t.div&&console.warn("no have div ,we will not display the video stream, just throw stream url");t=this.swOpen({prototype:t.prototype,tag:{div:t.div,channel:this,userdata:t.tag},useoptions:t,media:t.media,callback:this._eventHandle.onSwOpenExHasResult});return y.RcCode.bFaild(t)&&this._endOpenHasResult(!1),t},_onOpenFail:function(){this._open_status=y.SWVideoChanel._OpenStatus.NOT_OPEND},_eventHandle:{getProtoType:function(e,t){var n={rc:y.RcCode.RC_CODE_S_OK,prototype:-1,bHttpFlv:t},o=-1;return R.calltype==y.CallProtoType.OCX?o=S.ProtoType.OCX:"hls"==e?o=S.ProtoType.HLS:"rtmp"==e?t||h.supportFlash()?o=S.ProtoType.RTMP:(console.error("not supported flash (rtmp)"),n.rc=y.RcCode.RC_CODE_E_UNSUPPORTED):"auto"==e&&(flvjs.getFeatureList().mseLiveFlvPlayback||h.supportFlash())?(o=S.ProtoType.RTMP,n.bHttpFlv=!0):o=t||h.supportFlash()?S.ProtoType.RTMP:S.ProtoType.HLS,n.prototype=o,n},sendOpenChanel:function(e,t,n,o){null!=n&&S.ProtoType.OCX==o.getProto()&&(o.setHwnd(n.GetWMHwnd()),n.style.display="block",o.getBwindowless()&&o.setHplayhandle(n.GetWMHwnd()));o=S.JsonParamDialog(e._p_emms,proto.WEBBVCU.MSGType.WEB_BVCU_OPEN_CHANLE,o);return S._internalSend({cmd:S.RequestHeader.openchanle.cmd,session:e,request:o,callback:t.callback,opt:t,tag:t.tag})},beforeOpenPreparePlayDiv:function(e,t,n,o){var i=null,s=!1;void 0===t.bv_uuid&&(t.bv_uuid=h.generateUUID());var r,a=t.bv_uuid+"_0077553",l=document.getElementById(a);return null!=l&&(l.style.display="none"),a=t.bv_uuid+"_0077554",null!=(l=document.getElementById(a))&&(l.style.display="none"),S.ProtoType.HLS==e||S.ProtoType.RTMP==e?(r=t.bv_uuid+"_0077553",null==(i=document.getElementById(r))&&((i=document.createElement("VIDEO")).setAttribute("id",r),i.setAttribute("class","bvvideo-js vjs-default-skin vjs-big-play-centered"),t.appendChild(i)),i.style.width="100%",i.style.height="100%",i.style.display="block"):S.ProtoType.OCX==e&&(e=(r=t.bv_uuid+"_0077554")+"tempdiv",null==(i=document.getElementById(r))&&(null==(e=document.getElementById(e))&&((e=document.createElement("div")).id=r+"tempdiv",e.style.width="100%",e.style.height="100%"),e.style.display="block",t.appendChild(e),(i=y.SWVideoChanel._Ocx_PlayObjMgr.GetPlayObj(n)).id=r,i.tag=this,e.appendChild(i),s=!0,null==(e=document.getElementById(r+"ocxeventid"))&&((e=document.createElement("script")).id=r+"ocxeventid",e.type="text/javascript",e.setAttribute("for",r),e.setAttribute("event","OnHwndEvent(hwnd, ieventtype, pParam)"),e.text="jSW._swOcxPlayerOnEvent(ieventtype, this.tag);",document.body.appendChild(e)))),{playObj:i,isNeedDelay:s}},onSwOpenExHasResult:function(e,t,n){var o=t.getPayload(),i=proto.WEBBVCU.Open_Dialog_Response.deserializeBinary(o),s=e.tag.channel,r=e.tag.userdata,a="",l=e.request.getPayload(),u=proto.WEBBVCU.BVCU_DialogParam.deserializeBinary(l),c=-1,_=y.RcCode.bSuccess(t.getCode()),d=u.getProto(),p=e.opt.useoptions,o=e.opt.useoptions.bHttpFlv;n&&(n.bHttFlv=o),o&&(f=y.DependencyMgr.GetModule("HttpFlv")),i.hasUrl()&&(a=i.getUrl());var h,g,l=null;if(_&&n)if(n.userOpt=p,i.hasHdlg()&&(c=s._buildHdlg(i.getHdlg(),d),n.setParams(e.tag.div,c,u.getMedia(),d),s._pushCommDlg(n,d)),null!=e.session&&(u.getId(),u.getMajor(),null!=(h=s)&&(d==S.ProtoType.HLS?g=R.http+a:d==S.ProtoType.RTMP&&(g=o?f.buildUrlFromRtmpUrl(R.http,a,p.usews):"rtmp://"+R.ip+a),h._url_chanel={proto:h.swSrcType({hdlg:c}),url:g})),null==e.tag.div||o||d!=S.ProtoType.HLS&&d!=S.ProtoType.RTMP)o?e.tag.div&&(E=f.CreatePlayer(e.tag.div,g,n),l={hdlg:n._hDlg,videoEle:E._mediaElement},null!=s&&s._OnNeedSaveVideoPlayer(E)):d==S.ProtoType.OCX&&(l={hdlg:n._hDlg});else{var f=e.tag.div.bv_uuid+"_0077553";if(null==document.getElementById(f))return void console.error("not have player");var C=null,m=null;d==S.ProtoType.HLS?(C=R.http+a,h.ismuti&&(l={hdlg:n._hDlg})):d==S.ProtoType.RTMP&&(m="rtmp://"+R.ip+a,h.ismuti&&(l={hdlg:n._hDlg}));var E=bvVideojs(f,{controlBar:!1,controls:!1},function(){d==S.ProtoType.HLS?this.src({type:"application/vnd.apple.mpegurl",src:C}):d==S.ProtoType.RTMP&&this.src({type:"rtmp/flv",src:m}),this.play()});null!=s&&s._OnNeedSaveVideoPlayer(E),n&&(n.Player=E)}e=e.opt;e&&e.useoptions&&"function"==typeof e.useoptions.callback&&(e.useoptions.tag=r,e.useoptions.callback(e.useoptions,t,l)),e&&e.useoptions&&e.useoptions.chanel&&(e.useoptions.chanel.m_live_hls=C,e.useoptions.chanel.m_live_rtmp=m,e.useoptions.chanel.m_live_httpflv=g),s&&s._endOpenHasResult(_)},afterCloseDlgClearResource:function(e){if(e){var t=e.bv_uuid+"_0077553",n=document.getElementById(t+"tempdiv"),o=document.getElementById(t);if(null!=o&&(o.parentNode.removeChild(o),null!=n&&n.parentNode.removeChild(n)),"undefined"!=typeof bvVideojs)try{var i=bvVideojs(t);i&&(i.dispose(),this._videoPlayer=null)}catch(e){}t=e.bv_uuid+"_0077554",o=document.getElementById(t),n=document.getElementById(t+"tempdiv"),null!=o&&(o.parentNode.removeChild(o),y.SWVideoChanel._Ocx_PlayObjMgr.FreePlayObj(o)),null!=n&&n.parentNode.removeChild(n);t=document.getElementById(t+"ocxeventid");t&&t.parentNode.removeChild(t)}},_checkMedia:function(e,t){var n,o=0;for(n in t)o|=t[n];return!!(e|o==o)},checkMedia:function(e){var t=!1;return(t=R.CheckOcx()?this._checkMedia(e,[y.MEDIADIR.VIDEORECV,y.MEDIADIR.AUDIORECV]):this._checkMedia(e,[y.MEDIADIR.VIDEORECV]))||console.log("the media dir you want to view is not support"),t}},swAlterVolume:function(i){return this._intercom._volumeProxy(function(e,t){return void 0===i.volume||i.volume.icapture<0||100<i.volume.icapture||i.volume.iplay<0||100<i.volume.iplay?y.RcCode.RC_CODE_E_BVCU_INVALIDARG:(R.CheckOcx()?((o=new proto.WEBBVCU.BVCU_DialogControlParam_Render).setIplackbackvolume(i.volume.iplay),o.setIcapturevolume(i.volume.icapture),n=this._commSendProxy(i,function(){return{payload:o,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_ALTER_VIDEO_VOLUME,cmd:"swAlterVolume",hdlg:t}})):((n=(n=this._autoDlgProxy(i,function(e){e=e.getVideoElement();return e?(e.volume=i.volume.iplay/100,y.RcCode.RC_CODE_S_OK):y.RcCode.RC_CODE_E_FAIL}))==y.RcCode.RC_CODE_E_NOTFOUND?y.RcCode.RC_CODE_S_OK:n)==y.RcCode.RC_CODE_S_OK&&this.onAlterVolumeOk(e),y.SWVideoChanel.InterCom.delayInvoke(i.callback,n,i.tag)),n);var n,o},this)},onAlterVolumeOk:function(e){this._intercom.setVolume(e)},swGetVolume:function(e){var n=null,t=this._intercom._volumeProxy(function(e,t){return n=e,y.RcCode.RC_CODE_S_OK},this);return y.RcCode.bSuccess(t)&&y.SWVideoChanel.InterCom.delayInvoke(e.callback,y.RcCode.RC_CODE_S_OK,e.tag,n),console.log("on get volume ok"),t},onIntercomOpenOk:function(e){var t,n;return t=this,n=e.cb,e.cb=function(e){n&&n(e),y.RcCode.RC_CODE_S_OK!=e&&t.swCloseIntercom()},this._intercom.onOpenHasResult(e)},onIntercomCloseOK:function(e){this._intercom.onCloseHasResult(e)},onAlterMedirDirOk:function(e,t,n){e?(n=this._commDlgMgr.get(n))&&n.onMediaChange(t):this._intercom.onAlterHasResult(t)},swOpenCommand:function(e){e={isSendAudio:!0,isRecvAudio:!1,callback:e.callback,tag:e.tag};return this.swOpenIntercom(e)},swCloseCommand:function(e){return this.swCloseIntercom(e)},swOpenIntercom:function(o){var e=this._intercom._openProxy(function(e){var t=((o=h.extend({},{isSendAudio:!0,isRecvAudio:!0,callback:null,tag:null},o||{})).isSendAudio?y.MEDIADIR.AUDIOSEND:y.MEDIADIR.ALLNULL)+(o.isRecvAudio?y.MEDIADIR.AUDIORECV:y.MEDIADIR.ALLNULL),n=new proto.WEBBVCU.CommonData;return n.setIdata1(t),this._commSendProxy(o,function(){return{payload:n,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_OPEN_INTERCOM,cmd:"",hdlg:-1}})},this);return e},swCloseIntercom:function(t){return this._intercom._closeProxy(function(e){return this._commSendProxy(t,function(){return{payload:null,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_CLOSE_INTERCOM,cmd:"",hdlg:e}})},this)},swAlterAudioDir:function(i){return this._intercom._alterProxy(function(e,t){var n=(e&y.MEDIADIR.AUDIORECV)==y.MEDIADIR.AUDIORECV,e=(e&y.MEDIADIR.AUDIOSEND)==y.MEDIADIR.AUDIOSEND;if((i=h.extend({},{isSendAudio:e,isRecvAudio:n,callback:null,tag:null},i||{})).isRecvAudio==n&&i.isSendAudio==e)return console.log("i dont't think you should alter video dir, current status is you wished!"),y.RcCode.RC_CODE_S_OK;var e=(i.isRecvAudio?y.MEDIADIR.AUDIORECV:y.MEDIADIR.ALLNULL)+(i.isSendAudio?y.MEDIADIR.AUDIOSEND:y.MEDIADIR.ALLNULL),o=new proto.WEBBVCU.CommonData;return o.setIdata1(e),this._commSendProxy(i,function(){return{payload:o,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_ALTER_AUDIO_DIALOG_DIR,cmd:"",hdlg:t}})},this)},swBIsIntercomOpened:function(){return this._intercom.bIsOpen()},_swRecorderProxySet:function(e,t){if(R.CheckOcx())return y.RcCode.RC_CODE_E_UNSUPPORTED;if(t&&t.bh265)return y.RcCode.RC_CODE_E_UNSUPPORTED;var n=t._mdiv;return t&&t._recorder?y.RcCode.RC_CODE_E_BVCU_BUSY:t&&n&&0<n.getElementsByTagName("video").length&&(t._recorder=e(n.getElementsByTagName("video")[0]),t._recorder)?y.RcCode.RC_CODE_S_OK:y.RcCode.RC_CODE_E_FAIL},_swRecorderProxyGet:function(e,t){return R.CheckOcx()||t&&t.bh265?y.RcCode.RC_CODE_E_UNSUPPORTED:t._recorder?e.bind(this)(t._recorder):y.RcCode.RC_CODE_E_NOTFOUND},_swRecorderProxyGetClear:function(e){delete e._recorder},_swRecorderProxyGetAfterDlgClose:function(t){return this._swRecorderProxyGet(function(e){return this._swRecorderProxyGetClear(t),"inactive"==e.state?y.RcCode.RC_CODE_E_FAIL:(e.stop(),y.RcCode.RC_CODE_S_OK)},t)},swStartRecord:function(n){return this._autoDlgProxy(n,function(e){return this._swRecorderProxySet(function(e){let t=void 0;if(e.captureStream?t=e.captureStream():e.mozCaptureStream&&t.mediaElement.mozCaptureStream(),t&&0<t.getTracks().length){let o=new MediaRecorder(t);return o.ondataavailable=function(e){var t=URL.createObjectURL(e.data),n=document.createElement("a");n.href=t,n.target="_blank",o.swRecordFileName?n.download=o.swRecordFileName+".webm":n.download=e.timecode+".webm",n.click(),URL.revokeObjectURL(t)},o.onerror=function(e){var t;n.callback?(t=n.callback,n.callback=null,t({tag:n.tag},{emms:{code:y.RcCode.RC_CODE_S_OK}},o)):n.errCallback&&n.errCallback({tag:n.tag},{emms:{code:y.RcCode.RC_CODE_E_FAIL}},e)},o.onstart=function(){var e=n.callback;e&&(n.callback=null,e({tag:n.tag},{emms:{code:y.RcCode.RC_CODE_S_OK}},o))},void 0!==n.fileName&&(o.swRecordFileName=n.fileName),o.start(),o}return null},e)})},swEndRecord:function(t){return this._autoDlgProxy(t,function(e){e=this._swRecorderProxyGetAfterDlgClose(e);return e==y.RcCode.RC_CODE_S_OK&&t.callback&&setTimeout(function(){t.callback({tag:t.tag},{emms:{code:y.RcCode.RC_CODE_S_OK}})},50),e})},swAlterVideoDir:function(i){return this._autoDlgProxy(i,function(t){if(null==t)return y.RcCode.RC_CODE_E_NOTFOUND;var e=t.getMedia(),n=(e&y.MEDIADIR.VIDEORECV)==y.MEDIADIR.VIDEORECV,e=(e&y.MEDIADIR.AUDIORECV)==y.MEDIADIR.AUDIORECV;if((i=h.extend({},{isRecvAudio:e,isRecvVideo:n,div:null,callback:null,tag:null,hDlg:-1},i||{})).isRecvAudio==e&&i.isRecvVideo==n)return console.log("i dont't think you should alter video dir, current status is your wished!"),y.RcCode.RC_CODE_S_OK;var o=(i.isRecvAudio?y.MEDIADIR.AUDIORECV:y.MEDIADIR.ALLNULL)+(i.isRecvVideo?y.MEDIADIR.VIDEORECV:y.MEDIADIR.ALLNULL);if(this.swClose(t._hDlg)!=y.RcCode.RC_CODE_S_OK)return y.RcCode.RC_CODE_E_FAIL;{let e=this;return setTimeout(function(){e.swOpenEx({ismuti:e.ismuti,div:t._mdiv,media:o,prototype:e._prototype,usews:t.usews,callback:function(e,t,n){let o=e.tag;o.callback&&o.callback({tag:o.tag},{emms:t.emms},n)},tag:i})!=y.RcCode.RC_CODE_S_OK&&i.callback&&i.callback({tag:i.tag},{emms:{code:y.RcCode.RC_CODE_E_FAIL}})},200),y.RcCode.RC_CODE_S_OK}})},swGetLocalRecord:function(e){return R.CheckNotOcx()?(console.error("only ocx support local record"),y.RcCode.RC_CODE_E_FAIL):this._autoDlgSendProxy(e,function(){return{msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_LOCAL_RECORD}})},swSetLocalRecord:function(e){if(R.CheckNotOcx())return console.error("only ocx support local record"),RC_CODE_E_FAIL;e=h.extend({},{szpath:"",ifileleninseconds:-1,callbak:null,recordCallback:null,tag:null},e||{});var t=new proto.WEBBVCU.LocalStorage;return t.setDir(h.string2Uint8Array(e.szpath)),t.setIfileleninseconds(Number(e.ifileleninseconds)),this._callbackAfterRecordHasResult=e.recordCallback,this._autoDlgSendProxy(e,function(){return{payload:t,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_LOCAL_RECORD}})},swSetNruRecord:function(e){e=h.extend({},{istart:0,ilength:-1,imediadir:0,callbak:null,recordCallback:null,tag:null},e||{});var t=new proto.BVCU.NRUConfig.ManualRecord;return t.setSzid(this._parent._id_pu),t.setIchannelindex(this._id_chanel),t.setBstart(e.istart),t.setIlength(e.ilength),t.setImediadir(e.imediadir),S.SendRequest({session:this._parent._parent,payload:t,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_SUBMETHOD_NRU_MANUALRECORD,callback:e.callback,tag:e.tag})},swGetUrl:function(){return this._url_chanel},swSnapshot:function(e){return e=h.extend({},{callback:null,tag:null},e||{}),this._autoDlgSendProxy(e,function(){return{msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_SNAPSHOT}})},swGetPtzAttr:function(e){if(null==this._parent&&this._parent._parent)return console.error("internal error, this._parent is null"),y.RcCode.RC_CODE_E_INVALIDARG;e=h.extend({},{callback:null,tag:null},e||{});var t=this._parent._parent,n=new S.BVCU_Command(this._parent._id_pu,this._id_chanel),o=S.RequestHeader.getptzattr,n=new S.JsonParamCommand(t._p_emms,o.requestHeader,n);return S._internalSend({cmd:S.RequestHeader.getptzattr.cmd,session:t,cmd:o.cmd,request:n,callback:e.callback,tag:e.tag})},swSetPtzAttr:function(e){},swPtzCtrl:function(e){if(null==this._parent&&this._parent._parent)return console.error("internal error, this._parent is null"),y.RcCode.RC_CODE_E_INVALIDARG;e=h.extend({},{ptzCtrl:{iPTZCommand:0,bStop:1,iParam1:0,iParam2:0,iParam3:0},callback:null,tag:null},e||{});var t=this._parent._parent,n=new proto.BVCU.PUConfig.PTZControl;n.setIptzcommand(e.ptzCtrl.iPTZCommand),n.setBstop(e.ptzCtrl.bStop),n.setIparam1(e.ptzCtrl.iParam1),n.setIparam2(e.ptzCtrl.iParam2),n.setIparam3(e.ptzCtrl.iParam3);n=new S.BVCU_Command(this._parent._id_pu,this._id_chanel,n),n=new S.JsonParamCommand(t._p_emms,proto.WEBBVCU.MSGType.WEB_BVCU_SET_PTZ,n);return S._internalSend({cmd:S.RequestHeader.ptzctrl.cmd,session:t,request:n,callback:e.callback,tag:e.tag})},_swKeepLiveDlg:function(e){var t=e.getOpts(),t=this._autoDlgSendProxy(t,function(){return{msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_KEEPALIVE,payload:null,cmd:S.RequestHeader.keeplive.cmd}});return console.log("keeplive chanel: "+e.getInfo()),t},swKeepLive:function(){this._commDlgMgr.each(this._swKeepLiveDlg,this),this._intercom._keep_alive(function(e){this._commSendProxy({hdlg:e},function(){return{msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_KEEPALIVE,payload:null,cmd:S.RequestHeader.keeplive.cmd}})},this)},swHide:function(e){return this._autoDlgProxy(e,function(e,t,n,o){var i=e.getPlayDiv(),e=i+"_0077553";try{!bvVideojs||"undefined"==typeof bvVideojs||(s=bvVideojs(e))&&s.dispose()}catch(e){}var s=document.getElementById(e);return null!=s&&(s.style.display="none"),e=i.bv_uuid+"_0077554",null!=(s=document.getElementById(e))&&(s.style.display="none"),y.RcCode.RC_CODE_S_OK}),y.RcCode.RC_CODE_S_OK},swShow:function(e){this._autoDlgProxy(e,function(e,t,n,o,i){var s=e.getPlayDiv(),r=e.getProteType();if(r==S.ProtoType.HLS||r==S.ProtoType.RTMP){var a,l=s.bv_uuid+"_0077553",u=document.getElementById(l);null!=u?u.style.display="block":((u=document.createElement("VIDEO")).setAttribute("id",l),u.setAttribute("class","bvvideo-js vjs-default-skin vjs-big-play-centered"),u.style.width="100%",u.style.height="100%",u.style.display="block",s.appendChild(u));try{0==e.bHttFlv&&(a=this,bvVideojs(l,{controlBar:!1,controls:!1},function(){r==S.ProtoType.HLS?this.src({type:"application/vnd.apple.mpegurl",src:a.m_live_hls}):r==S.ProtoType.RTMP&&this.src({type:"rtmp/flv",src:a.m_live_rtmp}),this.play()}))}catch(e){console.warn(e.message)}}else r==S.ProtoType.OCX&&(l=s.bv_uuid+"_0077554",null!=(u=document.getElementById(l))&&(u.style.display="block"),setTimeout(this._updateDialog.bind(this),500,i))})},_clear:function(){this.swBIsIntercomOpened()&&this.swCloseIntercom(),this._commDlgMgr.each(function(e,t){t&&e&&t.swClose(e.getHDlg())},this,this)},swClose:function(e){e={hdlg:e},this._commDlgMgr.CanIDoClose();return this._autoDlgSendProxy(e,function(e){this._swRecorderProxyGetAfterDlgClose(e);var t=e.getDlgParams();return y.DependencyMgr.GetModule("HttpFlv").ClosePlayer(e),{msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_CLOSE_CHANLE,payload:t,cmd:S.RequestHeader.closechanle.cmd,bcancel:!1}},function(e){var t=e.getPlayDiv();this._eventHandle.afterCloseDlgClearResource(t),this._commDlgMgr.free(e.getHDlg()),this._closeHasResult(!0),console.log("close chanel: "+e.getInfo())})},compare:function(e){return!!this._parent.compare(e._parent)&&this._id_chanel==e._id_chanel}}},function(e,t,n){var n=n(0),o=n.jSW,i=n.jSWProtocol;n.jSWUtils,n.jSWOptions,n.PuLoad,n.AudioMgr,n.HTTPNruFile;o.CommonDlgMgr=function(e){this._session=e,this._arraydlg=[],this.prototype=-1},o.CommonDlgMgr.prototype={push:function(e){var t=this.buildKey(e.getHDlg());e!=this._arraydlg[t]&&(this._arraydlg[t]=e,this._arraydlg.length++),this.prototype=e._prototype},createAndSave:function(e,t){e=new o.CommonDlg(e,t);return this.push(e,t),e},get:function(e){e=this.buildKey(e);return this._arraydlg[e]},getSession:function(){return this._session},each:function(e,t,n){for(iindex in this._arraydlg)if(this._arraydlg[iindex])if(t){if(e.bind(t)(this._arraydlg[iindex],n))break}else if(e(this._arraydlg[iindex],n))break},free:function(e){null!=this._arraydlg[this.buildKey(e)]&&this._arraydlg.length--,this._arraydlg[this.buildKey(e)]=null},buildKey:function(e){return"dlg"+e},getDefault:function(){var t=null;return this.each(function(e){if(null==t)return t=e,!0}),t},CanIDoClose:function(){return!(i.ProtoType.RTMP==this.prototype&&1<this._arraydlg.length)}},o.CommonDlg=function(e,t){this._channel=e,this._hDlg=t,this._mdiv=null,this._dlgParams=null,this._media=0,this._rotate=0,this._prototype=-1,this._info="",this.bh265=!1},o.CommonDlg.prototype={getkey:function(){return this._hDlg},compare:function(e){return this.getkey()==e.getkey()},getHDlg:function(){return this._hDlg},getDlgParams:function(){return null==this._dlgParams&&(this._dlgParams=i.BVCU_DialogParam(this._channel._parent._id_pu,this._channel._id_chanel,0,this._prototype,0,0,this._hDlg)),this._dlgParams},getPlayDiv:function(){return this._mdiv},setParams:function(e,t,n,o){this._mdiv=e,this._hDlg=t,this._media=n,this._prototype=o},getMedia:function(){return this._media},getRotate:function(){return this._rotate},setRotate:function(e){this._rotate=e},getProteType:function(){return this._prototype},getOpts:function(e){return(e=e||{hdl:-1}).hdlg=this._hDlg,e},getInfo:function(){return""==this._info&&(this._info=this._channel._parent._id_pu+" "+this._channel._id_chanel+" "+this._hDlg),this._info},onMediaChange:function(e){this._media=e},_reset:function(){this._media=0},setHdlg:function(e){this._hDlg=e},getVideoElement:function(){return(this._prototype==i.ProtoType.HLS||this._prototype==i.ProtoType.RTMP)&&this._mdiv&&this._mdiv.getElementsByTagName("video")?this._mdiv.getElementsByTagName("video")[0]:null}}},function(e,t,n){var n=n(0),i=n.jSW,o=(n.jSWProtocol,n.jSWUtils,n.jSWOptions),s=(n.PuLoad,n.AudioMgr);n.HTTPNruFile;i.SWVideoChanel.InterComStatus=function(){this._status=i.SWVideoChanel.InterComStatus.Types.INIT},i.SWVideoChanel.InterComStatus.Types={INIT:0,DOING:1,DONE:2},i.SWVideoChanel.InterComStatus.prototype={reset:function(){this._status=i.SWVideoChanel.InterComStatus.Types.INIT},setDoing:function(){this._status=i.SWVideoChanel.InterComStatus.Types.DOING},setDone:function(){this._status=i.SWVideoChanel.InterComStatus.Types.DONE},bInit:function(){return!o.CheckHttp()&&i.SWVideoChanel.InterComStatus.Types.INIT==this._status},bDoing:function(){return i.SWVideoChanel.InterComStatus.Types.DOING==this._status},bDone:function(){return i.SWVideoChanel.InterComStatus.Types.DONE==this._status}},i.SWVideoChanel.InterCom=function(e){this.status=new i.SWVideoChanel.InterComStatus,this._commDlg=new i.CommonDlg(e),this._channel=e,this._volume={icapture:50,iplay:50}},i.SWVideoChanel.InterCom.delayInvoke=function(e,t,n,o){n={tag:n},t={emms:{code:t}};o?setTimeout(e,50,n,t,o):setTimeout(e,50,n,t)},i.SWVideoChanel.InterCom.prototype={_getCurMedia:function(){return this._commDlg.getMedia()},_getHdlg:function(){return this._commDlg.getHDlg()},_openProxy:function(e,t){var n;i.RcCode.RC_CODE_E_FAIL;return this.status.bDone()?(console.log("intercom has opened, can not be open twice! you can call swAlterAudioDir to change medir dir or close it try again!"),i.RcCode.RC_CODE_E_ALREADYEXIST):this.status.bDoing()?i.RcCode.RC_CODE_E_BUSY:(this.status.setDoing(),n=e.bind(t)(this._getCurMedia()),i.RcCode.bFaild(n)&&this.status.reset(),n)},_closeProxy:function(e,t){var n;i.RcCode.RC_CODE_E_FAIL;return this.status.bInit()?i.RcCode.RC_CODE_E_NOTFOUND:this.status.bDoing()?i.RcCode.RC_CODE_E_BUSY:(this.status.setDoing(),n=e.bind(t)(this._getHdlg()),i.RcCode.bFaild(n)&&this.status.setDone(),n)},_alterProxy:function(e,t){var n;i.RcCode.RC_CODE_E_FAIL;return this.status.bInit()?i.RcCode.RC_CODE_E_NOTFOUND:this.status.bDoing()?i.RcCode.RC_CODE_E_BUSY:(n=e.bind(t)(this._getCurMedia(),this._getHdlg()),i.RcCode.bFaild(n),n)},_volumeProxy:function(e,t){var n;i.RcCode.RC_CODE_E_FAIL;return this.status.bInit()?i.RcCode.RC_CODE_E_NOTFOUND:this.status.bDoing()?i.RcCode.RC_CODE_E_BUSY:(n=e.bind(t)(this.__getVolume(),this._getHdlg()),i.RcCode.bFaild(n),n)},__getVolume:function(){return{icapture:this._volume.icapture,iplay:this._volume.iplay}},setVolume:function(e){this._volume={icapture:e.icapture,iplay:e.iplay}},_clear:function(e,t){this.status.bDone()&&(e.bind(t)(this._getHdlg()),this._reset())},_keep_alive:function(e,t){this.status.bDone()&&e.bind(t)(this._getHdlg())},_reset:function(){this.status.reset(),this._commDlg._reset()},_check_media_has_audio_send:function(e){return(e&i.MEDIADIR.AUDIOSEND)==i.MEDIADIR.AUDIOSEND},onAlterHasResult:function(e){this._check_media_has_audio_send(e)?s.StartAudio():s.StopAudio(),this._commDlg.onMediaChange(e),this.status.setDone()},onOpenHasResult:function(e){var t=e.bresult;if(!t)return this._reset(),i.RcCode.RC_CODE_E_FAIL;var n=e.iMedia,o=e.hDlg;return this._commDlg.onMediaChange(n),this._commDlg.setHdlg(o),this.status.setDone(),t&&this._check_media_has_audio_send(n)&&s.StartAudio(e),i.RcCode.RC_CODE_S_OK},onCloseHasResult:function(e){this._reset(),e&&s.StopAudio()},bIsOpen:function(){return this.status.bDone()}}},function(e,t,n){var n=n(0),o=n.jSW,r=n.jSWProtocol;n.jSWUtils,n.jSWOptions,n.PuLoad,n.AudioMgr,n.HTTPNruFile;o.SWGPSChanel=function(e,t){this._parent=e,this._updateInfo(t),this.m_is_open=!1,this._callback=null,this._hDlg=-1,this._bDlgOpened=!1},o.SWGPSChanel.prototype={_updateInfo:function(e){this._info_chanel={id:e.ichannelindex,name:e.szname,ptz:e.iptz,media:e.imediadir>>10,status:1023&e.imediadir},this._id_chanel=this._info_chanel.id,this._name_chanle=this._info_chanel.name},swClose:function(){var e=r.SendRequest({session:this._parent._parent,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_PUGPS_CHANNEL_CLOSE,target:this._parent._id_pu,targetIndex:this._id_chanel,tag:options.tag,hdlg:this._hDlg});return this._hDlg=-1,this.m_is_open=!1,this._bDlgOpened=!1,e},swOpen:function(e){return null==this._parent||null==this._parent._parent?(console.error("internal error, this._parent is null"),o.RcCode.RC_CODE_E_INVALIDARG):this.m_is_open?o.RcCode.RC_CODE_E_BUSY:(this.m_is_open=!0,this._callback=e.callback,this._tag=e.tag,r.SendRequest({session:this._parent._parent,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_OPEN_PUGPS_CHANNEL,target:this._parent._id_pu,targetIndex:this._id_chanel,callback:e.callback,tag:e.tag}))},_OnOpenGpsHasResult:function(e,t){o.RcCode.bSuccess(e)?(this._hDlg=t,this._bDlgOpened=!0):(this.m_is_open=!1,this._bDlgOpened=!1,this._hDlg=-1)},_tickGpsData:function(e){if(this._callback&&this._bDlgOpened)try{this._callback({tag:this._tag},{gps:e,emms:{code:0}},e)}catch(e){console.log(e)}},swGetGpsAttr:function(e){return r.SendRequest({session:this._parent._parent,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_GPS,target:this._parent._id_pu,targetIndex:this._id_chanel,callback:e.callback,tag:e.tag})},swSetPuGpsAttr:function(s){return this.swGetGpsAttr({chanelid:s.chanelid,callback:function(e,t,n){var o=new proto.BVCU.PUConfig.GPSParam,i=e.tag,e=i.options;return o.setBenable(e.isenable),o.setIsetupsatellitesignal(n.isetupsatellitesignal),o.setIreportinterval(n.ireportinterval),o.setIreportdistance(n.ireportdistance),r.SendRequest({session:i.session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_PU_GPS,target:i.puid,targetIndex:this._id_chanel,payload:o,callback:s.callback,tag:i.options.tag})},tag:{session:this._parent._parent,options:s,puid:this._parent._id_pu}})}}},function(e,t,n){var n=n(0),s=n.jSW,r=n.jSWProtocol,a=n.jSWUtils;n.jSWOptions,n.PuLoad,n.AudioMgr,n.HTTPNruFile;s.SWTSPChanel=function(e,t){this._parent=e,this._info_chanel={id:t.ichannelindex,name:t.szname,ptz:t.iptz,media:t.imediadir>>10,status:1023&t.imediadir},this._id_chanel=this._info_chanel.id,this._name_chanle=this._info_chanel.name,this._tspDigLog=null},s.SWTSPChanel.prototype={_OnTspDialog:function(e){this._tspDigLog=e},_updateInfo:function(e){this._info_chanel={id:e.ichannelindex,name:e.szname,ptz:e.iptz,media:e.imediadir>>10,status:1023&e.imediadir},this._id_chanel=this._info_chanel.id,this._name_chanle=this._info_chanel.name,this._meida_chanel=this._info_chanel.media,this._ptz_chanel=this._info_chanel.ptz},swClose:function(){if(null==this._parent||null==this._parent._parent)return console.warn("internal error, this._parent is null"),s.RcCode.RC_CODE_E_INVALIDARG;if(null==this._tspDigLog)return s.RcCode.RC_CODE_OK;var e=this._parent._parent,t=r.BVCU_DialogParam(this._parent._id_pu,this._id_chanel,0,r.ProtoType.OTHER,0,0,this._tspDigLog._hDlg),t=r.JsonParamDialog(e._p_emms,proto.WEBBVCU.MSGType.WEB_BVCU_CLOSE_CHANLE,t),t=r._internalSend({cmd:r.RequestHeader.closechanle.cmd,session:e,request:t});return this._tspDigLog=null,console.log("close chanel: "+this._parent._id_pu+" "+this._id_chanel),t},swOpen:function(e){if(null==this._parent||null==this._parent._parent)return console.error("internal error, this._parent is null"),s.RcCode.RC_CODE_E_INVALIDARG;var t=this._parent._parent,n=r.BVCU_DialogParam(this._parent._id_pu,this._id_chanel,0,r.ProtoType.OTHER,0),n=r.JsonParamDialog(t._p_emms,proto.WEBBVCU.MSGType.WEB_BVCU_OPEN_CHANLE_TSP,n);return e=a.extend({},{callback:null,tag:null},e||{}),r._internalSend({cmd:r.RequestHeader.openchanletsp.cmd,session:t,request:n,callback:e.callback,tag:e.tag})},swWrite:function(e){if(null==this._parent||null==this._parent._parent)return console.error("internal error, this._parent is null"),s.RcCode.RC_CODE_E_INVALIDARG;if(null==e.data)return console.error("write data is null"),s.RcCode.RC_CODE_E_INVALIDARG;var t=this._parent._parent,n=new proto.WEBBVCU.Notify_TSP_Data;if(n.setTargetid(this._parent._id_pu),n.setTargetindex(this._id_chanel),!(e.data instanceof Uint8Array))if(e.data instanceof Array){var o=new Uint8Array(e.data.length),i=null;for(iiteindex in e.data)i=(i=e.data[iiteindex]).replace("0x",""),o[iiteindex]+=16*Number(i.charAt(0)),o[iiteindex]+=Number(i.charAt(1));e.data=o}else e.data=a.string2Uint8Array(e.data);n.setData(e.data);n=r.JsonParamTSPDialog(t._p_emms,proto.WEBBVCU.MSGType.WEB_BVCU_WRITE_CHANLE_TSP,n);n.setHdlg(this._tspDigLog._hDlg);return e=a.extend({},{callback:null,data:null,tag:null},e||{}),r._internalSend({cmd:r.RequestHeader.writechanletsp.cmd,session:t,request:n,callback:e.callback,tag:e.tag})},swKeepLive:function(){if(null==this._parent&&this._parent._parent)return console.error("internal error, this._parent is null"),s.RcCode.RC_CODE_E_INVALIDARG;var e=this._parent._parent,t=new r.BVCU_DialogParam(this._parent._id_pu,this._id_chanel,0,r.ProtoType.OTHER,0),n=new r.JsonParamDialog(e._p_emms,proto.WEBBVCU.MSGType.WEB_BVCU_KEEPALIVE,t),n=r._internalSend({cmd:r.RequestHeader.keeplivechanle.cmd,session:e,request:n});return console.log("keeplive tsp chanel: "+t.getId()+" "+t.getMajor()),n},compare:function(e){return!!this._parent.compare(e._parent)&&this._id_chanel==e._id_chanel}}}]);
